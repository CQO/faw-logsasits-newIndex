(function(){"use strict";class EtsMapApi{constructor(){}static getApi(){return EtsMapApi._api}static setApi(e){EtsMapApi._api=e}static getViewer(){return EtsMapApi._viewer}static setViewer(e){EtsMapApi._viewer=e}}class Coord{constructor(){this._api=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}static test(){Cesium.GeoJsonDataSource.crsNames["urn:ogc:def:crs:EPSG::4524"]=Cesium.GeoJsonDataSource.crsNames["EPSG:4524"]=function(e){const t=e[0],i=e[1],a=proj4('PROJCS["CGCS2000 / 3-degree Gauss-Kruger zone 36", \n              GEOGCS["China Geodetic Coordinate System 2000", \n                DATUM["China 2000", \n                  SPHEROID["CGCS2000", 6378137.0, 298.257222101, AUTHORITY["EPSG","1024"]], \n                  AUTHORITY["EPSG","1043"]], \n                PRIMEM["Greenwich", 0.0, AUTHORITY["EPSG","8901"]], \n                UNIT["degree", 0.017453292519943295], \n                AXIS["Geodetic longitude", EAST], \n                AXIS["Geodetic latitude", NORTH], \n                AUTHORITY["EPSG","4490"]], \n              PROJECTION["Transverse_Mercator", AUTHORITY["EPSG","9807"]], \n              PARAMETER["central_meridian", 108.0], \n              PARAMETER["latitude_of_origin", 0.0], \n              PARAMETER["scale_factor", 1.0], \n              PARAMETER["false_easting", 36500000.0], \n              PARAMETER["false_northing", 0.0], \n              UNIT["m", 1.0], \n              AXIS["Easting", EAST], \n              AXIS["Northing", NORTH], \n              AUTHORITY["EPSG","4524"]]','GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],\n              AUTHORITY["EPSG", "6326"]], PRIMEM["Greenwich", 0, AUTHORITY["EPSG", "8901"]],\n              UNIT["degree", 0.0174532925199433, AUTHORITY["EPSG", "9122"]], AUTHORITY["EPSG", "4326"]]',[t,i]);return Cesium.Cartesian3.fromDegrees(a[0],a[1],0)}}static cartesianToCartographic(e){let t=Object.assign({},this.options,e),i=EtsMapApi.getViewer().scene.globe.ellipsoid,a=new EtsMapApi._api.Cartesian3(t.x,t.y,t.z),o=i.cartesianToCartographic(a);return{longitude:EtsMapApi.getApi().Math.toDegrees(o.longitude),latitude:EtsMapApi.getApi().Math.toDegrees(o.latitude),height:o.height}}static screenToCartographic=function(e){let t=EtsMapApi.getViewer().scene.globe.ellipsoid,i=EtsMapApi.getViewer().camera.pickEllipsoid({x:e.x,y:e.y},t);if(i){let e=t.cartesianToCartographic(i);return{longitude:EtsMapApi.getApi().Math.toDegrees(e.longitude),latitude:EtsMapApi.getApi().Math.toDegrees(e.latitude)}}return null};static cartographicToCartesian=function(e){this._viewer||(this._viewer=EtsMapApi.getViewer());let t=Object.assign({},this.options,e),i=EtsMapApi.getViewer().scene.globe.ellipsoid,a=EtsMapApi.getApi().Cartographic.fromDegrees(t.longitude,t.latitude,t.height);return i.cartographicToCartesian(a)}}class Camera{opts={longitude:113.776084923,latitude:23.02785011,height:500,orientation:[21.27879878293835,-45.34390550872461,.0716951918898415],duration:3,roll:0,pitch:-1.5707963267948966,heading:6.283185307179586,range:500,defaultX:2749380.293527422,defaultY:-20883616.67200641,defaultZ:14812115.631756518,thresholdX:0,thresholdY:0};constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}getPosition(e){let t=this._viewer.scene.camera,i=Coord.cartesianToCartographic(t.position),a={longitude:i.longitude,latitude:i.latitude,height:i.height,pitch:t.pitch,heading:t.heading,roll:t.roll,up:t.up.clone(),direction:t.direction.clone()};return e(a),a}setPosition(e){this._viewer.scene.camera.setView({destination:new this._etsMap.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height),orientation:{heading:e.heading||this.opts.heading,pitch:e.pitch||this.opts.pitch,roll:e.roll||this.opts.roll}})}lookAtBBox(e,t,i,a,o){if(!e||4!=e.length)throw"bbox\u6570\u636e\u683c\u5f0f\u6709\u8bef";this._viewer.camera.flyTo({destination:this._etsMap.Rectangle.fromDegrees(e[0],e[1],e[2],e[3]),duration:a||this.opts.duration,orientation:{heading:i||this.opts.heading,pitch:t||this.opts.pitch,roll:this.opts.roll}})}flyToRectangle(e){let t=Object.assign({},this.opts,e);this._viewer.camera.flyTo({destination:this._etsMap.Rectangle.fromDegrees(t.west-1e-4,t.south-1e-4,t.east+1e-4,t.north+1e-4),duration:t.duration,orientation:{heading:t.heading||this.opts.heading,pitch:t.pitch||this.opts.pitch,roll:t.roll||this.opts.roll}})}lookAt(e,t){const i=this._etsMap.Cartesian3.fromDegrees(e.longitude,e.latitude),a=this._etsMap.Math.toRadians(e.heading||this.opts.heading);let o=this._etsMap.Math.toRadians(e.pitch||this.opts.pitch);o=-90;this._viewer.camera.lookAt(i,new this._etsMap.HeadingPitchRange(a,-90,2500))}init(e){let t=Object.assign({},this.opts,e);this._viewer.camera.setView({destination:this._etsMap.Cartesian3.fromDegrees(t.longitude-Number(t.thresholdX),t.latitude-Number(t.thresholdY),t.height),orientation:{heading:t.heading||this.opts.heading,pitch:t.pitch||this.opts.pitch,roll:t.roll||this.opts.roll}})}flyTo(e){let t=Object.assign({},this.opts,e);this._viewer.camera.flyTo({destination:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),orientation:{heading:t.heading||this.opts.heading,pitch:t.pitch||this.opts.pitch,roll:t.roll||this.opts.roll},duration:t.duration,complete:function(){}})}flyToEntity(e,t){this._viewer.flyTo(e,t)}flyToObject(e){let t=Object.assign({},this.opts,e),i=this._viewer.screenSpaceEventHandler.getInputAction(this._etsMap.ScreenSpaceEventType.LEFT_CLICK);this._viewer.screenSpaceEventHandler.setInputAction((function(e){let a=this._viewer.scene.pick(e.position);if(this._etsMap.defined(a)){var o=Tools.transformCoordinates(e);this.flyTo({longitude:o[1],latitude:o[0]-.002,height:t.height,pitch:t.pitch})}else i(e)}),this._etsMap.ScreenSpaceEventType.LEFT_CLICK)}flyToByObject(e,t){let i=Object.assign({},this.opts,t);this._viewer.flyTo(e,{offset:{heading:this._etsMap.Math.toRadians(i.heading),pitch:this._etsMap.Math.toRadians(i.pitch),range:i.range},duration:i.duration})}backup(e){let t=Object.assign({},{longitude:108.845808,latitude:34.214282,height:17e6},e);var i={destination:new this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),duration:t.duration};this._viewer.camera.flyTo(i)}flyHome(e){e=e||0,this._viewer.camera.flyHome(e)}computeViewRectangle=function(){let e={},t=this._viewer.camera.computeViewRectangle();if(void 0===t)e=computeViewRectangleFor2D(this.viewer),null==e&&(e=getViewExtendFor2D(this.viewer));else{let i=t.west/Math.PI*180,a=t.north/Math.PI*180,o=t.east/Math.PI*180,r=t.south/Math.PI*180;e={west:i,south:r,east:o,north:a,southwest:{lng:i,latitude:r},northeast:{lng:o,latitude:a}}}return e};computeViewRectangleFor2D(){let e={},t=compute(this._viewer,window.innerWidth,window.innerHeight);return null==t?null:(e.east=t[0],e.south=t[1],t=compute(viewer,1,1),e.west=t[0],e.north=t[1],{west:e.west,south:e.south,east:e.east,north:e.north,southwest:{lng:e.west,latitude:e.south},northeast:{lng:e.east,latitude:e.north}})}getViewExtendFor2D(){let e=this._viewer.scene.canvas,t=new this._etsMap.Cartesian2(0,0),i=new this._etsMap.Cartesian2(e.clientWidth,e.clientHeight),a=this._viewer.scene.globe.ellipsoid,o=this._viewer.camera.pickEllipsoid(t,a),r=this._viewer.camera.pickEllipsoid(i,a),s=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(o),g=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(r),n=this._etsMap.Math.toDegrees(s.longitude),C=this._etsMap.Math.toDegrees(g.longitude),l=this._etsMap.Math.toDegrees(g.latitude),A=this._etsMap.Math.toDegrees(s.latitude);return{west:n,south:l,east:C,north:A,southwest:{longitude:n,latitude:l},northeast:{longitude:C,latitude:A}}}compute(e,t){var i=this._viewer.scene,a=new this._etsMap.Cartesian2(e,t),o=this._viewer.scene.globe.pick(viewer.camera.getPickRay(a),i);if(o){var r=this._etsMap.Cartographic.fromCartesian(o);return[r.longitude/Math.PI*180,r.latitude/Math.PI*180]}throw new this._etsMap.DeveloperError("Unable to get boundary data")}listener(e){let t=this;this.changed=this._viewer.camera.changed,this.camera=function(){let i=Math.ceil(t._viewer.camera.positionCartographic.height),a=this._etsMap.Math.toDegrees(t._viewer.camera.pitch).toFixed(2),o=new CimTools(CimMap,t.viewer),r=null;try{r=o.computeViewRectangle()}catch(e){console.log(e)}let s=Object.assign({},{height:i,pitch:Number(a),bounds:r});e(s)},this.changed.addEventListener(this.camera)}removeListener=function(){this.changed.removeEventListener(this.camera)}}class ShapeLayer{shapeEntities=[];opts={id:"",outline:!0,outlineWidth:1,outlineColor:"#ffffff",fill:!0,fillColor:"#ff9900",fillColorAlpha:1,height:1,show:!0,key:"",CIMMAP_STEP:window.CIMMAP_STEP||1};constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}addBoxes=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,x:50,y:50,z:50},e),i={attributes:t,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.z/2+t.height),name:"boxes",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,box:{dimensions:new this._etsMap.Cartesian3(t.x,t.y,t.z),outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),outlineWidth:1,fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addCylindrical=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,cylinderHeight:200,radius:100},e),i={position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.cylinderHeight/2+t.height),name:"cylindrical",type:"shape",show:t.show,attributes:t,key:t.key,cimLayerId:this.layerId,cylinder:{length:t.cylinderHeight,topRadius:t.radius,bottomRadius:t.radius,outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),outlineWidth:1,fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addCylindricalCones=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,cylinderHeight:200,topRadius:0,bottomRadius:100},e),i={position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.cylinderHeight/2+t.height),name:"cylindricalCones",type:"shape",show:t.show,attributes:t,key:t.key,cimLayerId:this.layerId,cylinder:{length:t.cylinderHeight,topRadius:t.topRadius,bottomRadius:t.bottomRadius,outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),outlineWidth:1,fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addPolygon=function(e){let t=Object.assign({},this.opts,{hierarchy:[],height:2},e),i={id:t.id,name:"polygon",type:"shape",show:t.show,attributes:t,key:t.key,cimLayerId:this.layerId,polygon:{hierarchy:this._etsMap.Cartesian3.fromDegreesArray(t.hierarchy),height:t.height,fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineWidth:1,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addRectangles=function(e){let t=Object.assign({},this.opts,{coordinates:{startLongitude:0,startLatitude:0,endLongitude:0,endLatitude:0}},e),i={attributes:t,name:"rectangles",type:"shape",key:t.key,cimLayerId:this.layerId,rectangle:{coordinates:this._etsMap.Rectangle.fromDegrees(t.coordinates.startLongitude,t.coordinates.endLatitude,t.coordinates.endLongitude,t.coordinates.startLatitude),material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),rotation:this._etsMap.Math.toRadians(0),fill:t.fill,extrudedHeight:t.extrudedHeight,outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addCircles=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,radius:100},e),i={attributes:t,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude),name:"circles",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,ellipse:{semiMinorAxis:t.radius,semiMajorAxis:t.radius,fill:t.fill,height:t.height,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineWidth:1,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor)}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addEllipses=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,semiMinorAxis:100,semiMajorAxis:300},e),i={attributes:t,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude),name:"ellipses",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,ellipse:{semiMinorAxis:t.semiMinorAxis,semiMajorAxis:t.semiMajorAxis,fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineWidth:1,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addTube=function(e){let t=Object.assign({},this.opts,{positions:[],color:"#ff9900",colorAlpha:1,height:1,radius:50},e),i=this;let a=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.colorAlpha)),o={attributes:t,name:"tube",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,polylineVolume:{positions:this._etsMap.Cartesian3.fromDegreesArray(t.positions),shape:function(e){let t=[];for(var a=0;a<360;a++){var o=i._etsMap.Math.toRadians(a);t.push(new i._etsMap.Cartesian2(e*Math.cos(o),e*Math.sin(o)))}return t}(t.radius),material:a,height:t.height}};t.id&&(o.id=t.id);let r=this._viewer.entities.add(o);return this.shapeEntities.push(r),r};addPolyline=function(e){let t=Object.assign({},this.opts,{positions:[113.776084923,23.02785011,113.779084923,23.02785011],width:1,color:"#ff9900",type:2,colorAlpha:1,height:1,glowPower:.1,outlineWidth:1,outlineColor:"#ffffff"},e),i=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.colorAlpha)),a=this._etsMap.Color.fromCssColorString(t.outlineColor),o={attributes:t,name:"polyline",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,polyline:{positions:this._etsMap.Cartesian3.fromDegreesArray(t.positions),width:t.width*t.CIMMAP_STEP,height:t.height}};switch(t.type){case 0:o.polyline.material=new this._etsMap.PolylineOutlineMaterialProperty({color:i,outlineWidth:t.outlineWidth,outlineColor:a});break;case 1:o.polyline.material=new this._etsMap.PolylineGlowMaterialProperty({glowPower:t.glowPower,color:i});break;case 2:o.polyline.material=i;break;case 3:o.polyline.material=new this._etsMap.PolylineArrowMaterialProperty(i);break;case 4:o.polyline.material=new this._etsMap.PolylineDashMaterialProperty({color:i})}t.id&&(o.id=t.id);let r=this._viewer.entities.add(o);return this.shapeEntities.push(r),r};addBoll=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,radius:50,height:1},e),i={attributes:t,name:"boll",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.radius+t.height),ellipsoid:{radii:new this._etsMap.Cartesian3(t.radius,t.radius,t.radius),fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),slicePartitions:24,stackPartitions:24,height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};addEllipsoids=function(e){let t=Object.assign({},this.opts,{longitude:113.776084923,latitude:23.02785011,x:50,y:150,z:50},e),i={attributes:t,name:"ellipsoids",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.z+t.height),ellipsoid:{radii:new this._etsMap.Cartesian3(t.x,t.y,t.z),fill:t.fill,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),slicePartitions:24,stackPartitions:24,height:t.height}};t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.shapeEntities.push(a),a};remove=function(e){let t=this;if(e){e.split(",").map((function(e){Tool.isExsitEntityId(t._viewer,e)&&(t.shapeEntities.map((function(i){i.id==e&&Tool.delArr(t.shapeEntities,i)})),t._viewer.entities.removeById(e))}))}else this.shapeEntities.map((function(e){t._viewer.entities.removeById(e._id)})),this.shapeEntities=[]};show=function(e){let t=this;if(e){e.split(",").map((function(e){Tool.isExsitEntityId(t._viewer,e)&&t.shapeEntities.map((function(t){e==t.id&&(t.show=!0)}))}))}else this.shapeEntities.map((function(e){e.show=!0}))};hide=function(e){let t=this;if(e){e.split(",").map((function(e){Tool.isExsitEntityId(t._viewer,e)&&t.shapeEntities.map((function(t){e==t.id&&(t.show=!1)}))}))}else this.shapeEntities.map((function(e){e.show=!1}))};getById=function(e){return this._viewer.entities.getById(e)};addDyWall=function(){let e=this._etsMap;var t=new e.GeometryInstance({geometry:e.WallGeometry.fromConstantHeights({positions:e.Cartesian3.fromDegreesArray([97,43,107,43,107,40,97,40,97,43]),maximumHeight:1e5,vertexFormat:e.MaterialAppearance.VERTEX_FORMAT})});let i=new e.Color(1,0,0,1),a=new e.Material({fabric:{type:"PolylinePulseLink",uniforms:{color:i,image:"/apps/assets/images/btn.png",repeat:20,speed:10},source:"\n      czm_material czm_getMaterial(czm_materialInput materialInput)\n      {\n      czm_material material = czm_getDefaultMaterial(materialInput);\n      vec2 st = materialInput.st;\n\n      if(texture2D(image, vec2(0.0, 0.0)).a == 1.0){\n      discard;\n      }else{\n      material.alpha = texture2D(image, vec2(fract(repeat*st.s + speed*czm_frameNumber*0.005), st.t)).a * color.a;\n      }\n\n      material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb);\n\n      return material;\n      }\n      "},translucent:function(){return!0}});this._viewer.scene.primitives.add(new e.Primitive({geometryInstances:[t],appearance:new e.MaterialAppearance({material:a})}))};addWall=function(e){let t=Object.assign({},{positions:[],height:100,url:"",direction:"fromLeftToRight",show:!0,color:"#fff",intervalTime:2e3,repeat:300},e);function i(e,t){this._definitionChanged=new this._etsMap.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e,this.duration=t,this._time=(new Date).getTime()}t.url||(t.url="data:image/png;base64,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"),new Number(t.repeat).toFixed(1),Object.defineProperties(i.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:this._etsMap.createPropertyDescriptor("color")}),i.prototype.getType=function(e){return"wallTrailLink_"+t.id},i.prototype.getValue=function(e,t){return this._etsMap.defined(t)||(t={}),t.color=this._etsMap.Property.getValueOrClonedDefault(this._color,e,this._etsMap.Color.WHITE,t.color),t.image=this._etsMap.Material.WallTrailTrailLinkImage,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},i.prototype.equals=function(e){return this===e||e instanceof i&&this._etsMap.Property.equals(this._color,e._color)};let a={attributes:t,name:"wall",type:"shape",show:t.show,key:t.key,cimLayerId:this.layerId,wall:{positions:this._etsMap.Cartesian3.fromDegreesArrayHeights(t.positions),material:this._etsMap.Color.fromRandom({alpha:.7})}};t.id&&(a.id=t.id);let o=this._viewer.entities.add(a);return this._viewer.flyTo(o),this.shapeEntities.push(o),o}}class Scene{constructor(){this._control=null,this._layer=null,this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this._camera=new Camera}setViewerRange(e){let t=e.minZoom,i=e.maxZoom;t=null==t?50:t,i=null==i?550:i,viewer.scene.screenSpaceCameraController.minimumZoomDistance=t,viewer.scene.screenSpaceCameraController.maximumZoomDistance=i}getCamera(){return this._camera||(this._camera=new Camera),this._camera}getControl(){return this._control||(this._control=new SceneControl),this._control}getSceneTour(){return this._tour||(this._tour=new SceneTour),this._tour}getLayer(){return this._layer||(this._layer=new Layer),this._layer}getLayerTree(){return this._layerTree||(this._layerTree=new LayerTree),this._layerTree}setEventCallback(e){this._etsMap.setEventCallback(e)}getWeather(){return new Weather}sceneBorder=function(e){let t=this,i={west:117.99621765352147,north:35.31631154695579,east:118.07472611179409,south:35.2597306996189};if(e.maxHeight&&(this._viewer.scene.screenSpaceCameraController.maximumZoomDistance=e.maxHeight),e.minHeight&&(this._viewer.scene.screenSpaceCameraController.minimumZoomDistance=e.minHeight),!e||!e.bounds)return void console.log("\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u8fb9\u754c!");i.west=e.bounds.west-1e-5,i.north=e.bounds.north+1e-5,i.east=e.bounds.east+1e-5,i.south=e.bounds.south-1e-5;let a=this.getCamera(),o=new ShapeLayer,r=e.height||.5;if(e.wall=Object.assign({},{show:!1,height:5},e.wall),e.wall.show){let t=[e.bounds.west,e.bounds.south,r,e.bounds.west,e.bounds.north,r,e.bounds.east,e.bounds.north,r,e.bounds.east,e.bounds.south,r,e.bounds.west,e.bounds.south,r];this._etsMap.Cartesian3.fromDegreesArrayHeights(t),o.addWall({positions:t,intervalTime:100,minimumHeights:[e.wall.height,e.wall.height,e.wall.height,e.wall.height,e.wall.height]})}let s,g,n=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas),C=!0,l=!0,A=!0,I=!0,h=!1,c={west:0,south:0,east:0,north:0},p=0,d=0;return n.setInputAction((function(e){g=e.position,h=!0,C=!0,A=!0,l=!0,I=!0,t._viewer.scene.screenSpaceCameraController.enableRotate=!0,t._viewer.scene.screenSpaceCameraController.enableTranslate=!0}),this._etsMap.ScreenSpaceEventType.LEFT_DOWN),n.setInputAction((function(e){if(h=!1,!(C&&A&&l&&I)){let e=a.computeViewRectangle();c.west=e.west,c.south=e.south,c.east=e.east,c.north=e.north,c.west=c.west+p,c.east=c.east+p,c.south=c.south+d,c.north=c.north+d,a.getPosition((function(){})).pitch<t._etsMap.Math.toRadians(-85)&&a.flyToRectangle({west:c.west,south:c.south,east:c.east,north:c.north,duration:0}),p=0,d=0}}),this._etsMap.ScreenSpaceEventType.LEFT_UP),n.setInputAction((function(e){C=l=A=I=!0}),this._etsMap.ScreenSpaceEventType.WHEEL),n.setInputAction((function(e){if(s=e.endPosition,h){t._viewer.scene.screenSpaceCameraController.enableRotate=!0;let e=a.computeViewRectangle();e.west=e.southwest.lng,e.south=e.southwest.lat,e.east=e.northeast.lng,e.north=e.northeast.lat;let o=Coord.screenToCartographic(g),r=Coord.screenToCartographic(s);o&&r&&(e.west<i.west?(C=!1,o.longitude>r.longitude?C=!0:p=i.west-e.west,e.north>i.north&&(A=!1,o.latitude<r.latitude?A=!0:d=i.north-e.north),e.south<i.south&&(I=!1,o.latitude>r.latitude?I=!0:d=i.south-e.south)):e.north>i.north?(A=!1,o.latitude<r.latitude?A=!0:d=i.north-e.north,e.west<i.west&&(C=!1,o.longitude>r.longitude?C=!0:p=i.west-e.west),e.east>i.east&&(l=!1,o.longitude<r.longitude?l=!0:p=i.east-e.east)):e.east>i.east?(l=!1,o.longitude<r.longitude?l=!0:p=i.east-e.east,e.north>i.north&&(A=!1,o.latitude<r.latitude?A=!0:d=i.north-e.north),e.south<i.south&&(I=!1,o.latitude>r.latitude?I=!0:d=i.south-e.south)):e.south<i.south&&(I=!1,o.latitude>r.latitude?I=!0:d=i.south-e.south,e.west<i.west&&(C=!1,o.longitude>r.longitude?C=!0:p=i.west-e.west),e.east>i.east&&(l=!1,o.longitude<r.longitude?l=!0:p=i.east-e.east)),C&&A&&l&&I?(t._viewer.scene.screenSpaceCameraController.enableRotate=!0,t._viewer.scene.screenSpaceCameraController.enableTranslate=!0):(t._viewer.scene.screenSpaceCameraController.enableRotate=!1,t._viewer.scene.screenSpaceCameraController.enableTranslate=!1))}}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE),{remove:function(){n.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_UP),n.removeInputAction(this._etsMap.ScreenSpaceEventType.MOUSE_MOVE),n.removeInputAction(this._etsMap.ScreenSpaceEventType.WHEEL),n.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_DOWN),t._viewer.scene.screenSpaceCameraController.enableRotate=!0,t._viewer.scene.screenSpaceCameraController.enableTranslate=!0}}};morphTo2D=function(){this._viewer.scene.morphTo2D(0)};morphTo3D=function(){this._viewer.scene.morphTo3D(0)};centerRotation(e){let t=this,i=Object.assign({stop:!1,longitude:117.1423291616,latitude:39.0645831633,height:1555e3,pitch:-45,speed:100,duration:null},e);i.stop=!1;let a=Coord.cartographicToCartesian(i);EtsMapApi.getApi().Math.toRadians(i.pitch);let o=360/i.speed,r=EtsMapApi.getApi().JulianDate.fromDate(new Date);if(this._viewer.clock.startTime=r.clone(),i.duration&&!i.stop){let e=EtsMapApi.getApi().JulianDate.addSeconds(r,Number(i.duration),new this._etsMap.JulianDate);this._viewer.clock.stopTime=e.clone()}this._viewer.clock.currentTime=r.clone(),this._viewer.clock.clockRange=EtsMapApi.getApi().ClockRange.CLAMPED,this._viewer.clock.clockStep=EtsMapApi.getApi().ClockStep.SYSTEM_CLOCK;let s=this._viewer.camera.heading,g=function(){if(console.log("\u91cd\u65b0\u542f\u52a8"),i.stop)return;console.log(t._viewer.clock.currentTime,t._viewer.clock.startTime);let e=EtsMapApi.getApi().JulianDate.secondsDifference(t._viewer.clock.currentTime,t._viewer.clock.startTime),r=EtsMapApi.getApi().Math.toRadians(e*o)+s;i.heading=r,t._camera.setPosition(i),t._viewer.scene.camera.moveBackward(Number(i.height)),EtsMapApi.getApi().JulianDate.compare(t._viewer.clock.currentTime,t._viewer.clock.stopTime)>=0&&null!=i.duration&&""!=i.duration&&(t._viewer.clock.onTick.removeEventListener(g),i.stop=!0,t._camera.setPosition({position:a,heading:0,pitch:EtsMapApi.getApi().Math.toRadians(i.pitch)}),t._viewer.scene.camera.moveBackward(Number(i.height)))};this._viewer.clock.onTick.addEventListener(g);let n=!1;return{destroy:function(){return!n&&(t._viewer.clock.onTick.removeEventListener(g),i.stop=!0,t._camera.setPosition(i),t._viewer.scene.camera.moveBackward(Number(i.height)),n=!0,{isDestroy:n})},isDestroy:n,reStart:function(){t._viewer.clock.onTick.addEventListener(g),t._viewer.clock.shouldAnimate=!0}}}earthRotation(e){this._viewer.clock.multiplier=100,this._viewer.clock.shouldAnimate=!0;var t=this._viewer.clock.currentTime.secondsOfDay,i=e||1;let a=this;this._viewer.clock.onTick.addEventListener((function(){var e=a._viewer.clock.currentTime.secondsOfDay,o=(e-t)/1e3;t=e,a._viewer.scene.camera.rotate(a._etsMap.Cartesian3.UNIT_Z,-i*o)}))}stopEarthRoatation(){let e=this;this._viewer.clock.onTick.removeEventListener((function(){var t=e._viewer.clock.currentTime.secondsOfDay,i=(t-previousTime)/1e3;previousTime=t,e._viewer.scene.camera.rotate(e._etsMap.Cartesian3.UNIT_Z,-spinRate*i)})),this._viewer.clock.shouldAnimate=!1}light(e){this.viewer.scene.globe.enableLighting=!1;let t=this.viewer.scene.postProcessStages.bloom;void 0!==e.enabled?t.enabled=e.enabled:t.enabled=!0,t.uniforms.ambientOcclusionOnly=!1,t.uniforms.intensity=3,t.uniforms.lengthCap=.03,t.uniforms.blurStepSize=.86,void 0!==e.contrast&&(t.uniforms.contrast=e.contrast),void 0!==e.brightness&&(t.uniforms.brightness=e.brightness),void 0!==e.delta&&(t.uniforms.delta=e.delta),void 0!==e.sigma&&(t.uniforms.sigma=e.sigma),void 0!==e.stepSize&&(t.uniforms.stepSize=e.stepSize)}shadows=function(e){this.viewer.shadows=e};customSky=function(e){this.viewer.scene.backgroundColor=(new EtsMapApi.getApi).Color(0,0,0,0),this.viewer.scene.skyBox.show=!1,this.viewer.skyAtmosphere=!1;let t=this.viewer._container;return t.style.backgroundImage="url("+e.skyImage+")",t.style.backgroundRepeat="no-repeat",t.style.backgroundSize="100% 100%",t}}class Viewer{opts={vrButton:!1,animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,sceneMode:EtsMapApi.getApi().SceneMode.SCENE3D,navigationHelpButton:!1,scene3DOnly:!1,navigationInstructionsInitiallyVisible:!1,showRenderLoopErrors:!1,orderIndependentTranslucency:!0,contextOptions:{webgl:{alpha:!0}},creditsDisplay:!1,shouldAnimate:!0,shadows:!1,navigation:!1,locationInfo:!1,defaultImagery:!1,bloom:!0,sceneMode:3};constructor(e,t){if(this._api=EtsMapApi.getApi(),this.params=Object.assign(this.opts,t),this.viewer=new this._api.Viewer(e,this.params),this.viewer.scene.fxaa=!1,this.viewer.scene.postProcessStages.fxaa.enabled=!1,this.viewer.cesiumWidget._supportsImageRenderingPixelated){for(var i=window.devicePixelRatio;i>=2;)i/=2;this.viewer.resolutionScale=i}return EtsMapApi.setViewer(this.viewer),this.viewer}}class EtsMap{constructor(){this._scene="",this._viewer=null}initMap(e,t){return(t=t||{}).sceneMode=1,this.init(e,t)}init2DMap(e,t){return(t=t||{}).sceneMode=2,this.init(e,t)}init(e,t){EtsMapApi.setApi(Cesium),EtsMapApi.getApi().Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhNWRlOGM0Zi03NWI4LTRhZGUtYTU0MS1mZjM3Y2I1NzE2MjUiLCJpZCI6NzI0OCwic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTU0ODgzMjczOX0.7u3OVf3ejTgXlvqSVWlmPf1yb9LTJKgq-Qwnh4rCUsY";let i=new Viewer(e,t);return this._viewer=i,this._scene=new Scene,this._etsMap=EtsMapApi.getApi(),i.scene.debugShowFramesPerSecond=t.showFramesPerSecond||!1,t.onReady&&t.onReady(this._scene),this._scene}getViewer(){return this._viewer}getScene(){return this._scene||(this._scene=new Scene),this._scene}getApi(){return EtsMapApi.getApi()}getColor(){return this._color||(this._color=EtsMapApi.getApi().Color),this._color}}window.EtsMap=EtsMap;let Tools$1=class{constructor(){this._api=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}static distance=function(e,t){let i=(new EtsMapApi.getApi).EllipsoidGeodesic();i.setEndPoints(e,t);let a=i.surfaceDistance;return a=Math.sqrt(Math.pow(a,2)+Math.pow(t.height-e.height,2)),a};static getLocation(e,t,i){let a=e.getApi();this.handler=new a.ScreenSpaceEventHandler(e._viewer.canvas);let o=e._viewer;if(!this.handler)return;let r=o.scene;new a.ScreenSpaceEventHandler(r.canvas).setInputAction((function(e){var i=o.camera.getPickRay(e.position),r=o.scene.globe.pick(i,o.scene),s=a.Cartographic.fromCartesian(r),g=a.Math.toDegrees(s.longitude),n=a.Math.toDegrees(s.latitude);s.height,t({longitude:g,latitude:n,height:s.height})}),EtsMapApi.getApi().ScreenSpaceEventType.LEFT_CLICK)}static endPick(){this.handler&&this.handler.destroy()}pickPosition(e){let t=this._viewer.scene.pickPosition(e.position);return null!=t&&(EtsMapApi.getApi().defined(t)?t:void 0)}static angle(e,t,i){let a=Tools$1.bearing(t,e)-Tools$1.bearing(t,i);return a<0&&(a+=360),a}static bearing=function(e,t){let i=Math.PI/180,a=180/Math.PI,o=e.lat*i,r=e.lon*i,s=t.lat*i,g=t.lon*i,n=-Math.atan2(Math.sin(r-g)*Math.cos(s),Math.cos(o)*Math.sin(s)-Math.sin(o)*Math.cos(s)*Math.cos(r-g));return n<0&&(n+=2*Math.PI),n*=a,n};static transformCoordinates=function(e,t,i){var a=t.scene.globe.ellipsoid,o=t.camera.pickEllipsoid(i.position,a);if(o){var r=a.cartesianToCartographic(o);return[e.Math.toDegrees(r.longitude),e.Math.toDegrees(r.latitude)]}return[]};static delArr=function(e,t){let i=e.indexOf(t);i>-1&&e.splice(i,1)};static indexof=function(e){Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}};static isExsitEntityId=function(e,t){return null!=e.entities.getById(t)};static cartographicToCartesian=function(e,t,i,a,o){let r=t.scene.globe.ellipsoid,s=e.Cartographic.fromDegrees(i,a,o);return r.cartographicToCartesian(s)};static cartesianToCartographic=function(e,t,i,a,o){let r=t.scene.globe.ellipsoid,s=new e.Cartesian3(i,a,o),g=r.cartesianToCartographic(s);return[e.Math.toDegrees(g.longitude),e.Math.toDegrees(g.latitude),g.height]};static wgs84ToWindowCoordinates=function(e,t,i,a){let o=new e.Cartesian2,r=e.Cartesian3.fromDegrees(i,a,0);return t.scene.cartesianToCanvasCoordinates(r,o)};static getFeature=function(e,t){new e.ScreenSpaceEventHandler(t.scene.canvas).setInputAction((function(i){let a=t.scene.pick(i.position);if(e.defined(a)){if(void 0===a.id){let o=a.getProperty("name");return console.log(o),console.log(Tools$1.transformCoordinates(e,t,i)),o}console.log(a.id),console.log(Tools$1.transformCoordinates(e,t,i))}}),e.ScreenSpaceEventType.LEFT_CLICK)};static colorHex=function(e){let t=e;if(/^(rgb|RGB)/.test(t)){let e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a="#";for(var i=0;i<e.length;i++){let t=Number(e[i]).toString(16);t.length<2&&(t="0"+t),a+=t}return 7!==a.length&&(a=t),a}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){let e=t.replace(/#/,"").split("");if(6===e.length)return t;if(3===e.length){let t="#";for(i=0;i<e.length;i+=1)t+=e[i]+e[i];return t}}return t};static originalColorTo16=function(e){let t=[Math.round(255*e.red),Math.round(255*e.green),Math.round(255*e.blue)];return{color:Tools$1.colorHex("rgb("+t[0]+","+t[1]+","+t[2]+")"),alpha:e.alpha}};static rgbaTo16a=function(e){let t=e.replace(/(?:\(|\)|rgba|RGB)*/g,"").split(","),i=t[3],a=t.filter((function(e,t,i){return t!==i.length-1})).join(",");return{color:Tools$1.colorHex("rgb("+a+")"),alpha:i.replace(/(^\s*)|(\s*$)/g,"")}};static colorRgb=function(e){let t=e.toLowerCase();if(t&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){if(4===t.length){let e="#";for(let i=1;i<4;i+=1)e+=t.slice(i,i+1).concat(t.slice(i,i+1));t=e}let e=[];for(let i=1;i<7;i+=2)e.push(parseInt("0x"+t.slice(i,i+2)));return"RGB("+e.join(",")+")"}return t};static typeOf=function(e){return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(e)]};static trim=function(e){return(e||"").replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")};static get=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!1),i.onreadystatechange=function(){(4==i.readyState&&200==i.status||304==i.status)&&t.call(this,i.responseText)},i.send()};static Base64=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(t){var i,a,o,r,s,g,n,C="",l=0;for(t=_utf8_encode(t);l<t.length;)r=(i=t.charCodeAt(l++))>>2,s=(3&i)<<4|(a=t.charCodeAt(l++))>>4,g=(15&a)<<2|(o=t.charCodeAt(l++))>>6,n=63&o,isNaN(a)?g=n=64:isNaN(o)&&(n=64),C=C+e.charAt(r)+e.charAt(s)+e.charAt(g)+e.charAt(n);return C},this.decode=function(t){var i,a,o,r,s,g,n="",C=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");C<t.length;)i=e.indexOf(t.charAt(C++))<<2|(r=e.indexOf(t.charAt(C++)))>>4,a=(15&r)<<4|(s=e.indexOf(t.charAt(C++)))>>2,o=(3&s)<<6|(g=e.indexOf(t.charAt(C++))),n+=String.fromCharCode(i),64!=s&&(n+=String.fromCharCode(a)),64!=g&&(n+=String.fromCharCode(o));return n=_utf8_decode(n)},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var a=e.charCodeAt(i);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode=function(e){for(var t="",i=0,a=c1=c2=0;i<e.length;)(a=e.charCodeAt(i))<128?(t+=String.fromCharCode(a),i++):a>191&&a<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&a)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),i+=3);return t}};static deepCopy(e){let t=e;if(e instanceof Date)return t=new Date(e.getDate()),t;if(e instanceof Array){for(var i in t=[],e)t[i]=this.deepCopy(e[i]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=this.deepCopy(e[i]));return t}return e}};class EtsEvent{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas)}onClick(e,t){this.clickCallback=t;let i=this;if(0==arguments.length||arguments.length>2)return;"function"==Tools$1.typeOf(e)&&(this.clickCallback=e,e={});let a=Object.assign({featureName:[]},e),o=this._viewer;this.handler.setInputAction((function(e){console.log(e),e.position.z=0;let t=Coord.screenToCartographic(e.position),r=o.scene.pick(e.position);if(!i._etsMap.defined(r))return;let s=a.featureName.length;if(void 0===r.id||"point"!=r.id.type&&"line"!=r.id.type&&"shape"!=r.id.type){if(null==r.getProperty||"tileset"!=r.primitive.type){if("single"==r.primitive.type){let e=r.primitive.attributes;return s>0?-1!=a.featureName.indexOf(r.id)?void i.clickCallback(r.primitive,t,e):void i.clickCallback(void 0):void i.clickCallback(r.primitive,t,e)}return void i.clickCallback(void 0)}{let e=r.getProperty("name"),o=r.primitive.attributes;if(s>0){if(-1!=a.featureName.indexOf(e))return o.featureName=e,void i.clickCallback(r.primitive,t,o)}else 0==s&&(o.featureName=e,i.clickCallback(r.primitive,t,o))}}else{let e=r.id.attributes;if(!(a.featureName.length>0))return void i.clickCallback(r.id,t,e);if(-1!=a.featureName.indexOf(r.id.id))return void i.clickCallback(r.id,t,e)}}),this._etsMap.ScreenSpaceEventType.LEFT_CLICK)}onLeftDown(e){this.leftDownCallback=e;let t=this._viewer,i=this;t.screenSpaceEventHandler.setInputAction((function(e){let a=t.scene.pick(e.position),o=i._etsMap.defined(a)?a:void 0;o&&o&&(void 0!==o.id&&"point"==o.id.type?i.leftDownCallback(o.id,e):null!=o.getProperty&&"tileset"==o.primitive.type||"single"==o.primitive.type?i.leftDownCallback(o.primitive,e):i.leftDownCallback(void 0,e))}),this._etsMap.ScreenSpaceEventType.LEFT_DOWN)}onLeftUp=function(e){this.leftUpCallback=e;let t=this._viewer,i=this;t.screenSpaceEventHandler.setInputAction((function(e){let t=i._etsMap.defined(picked)?picked:void 0;t&&t&&(void 0!==t.id&&"point"==t.id.type?i.leftUpCallback(t.id,e):null!=t.getProperty&&"tileset"==t.primitive.type||"single"==t.primitive.type?i.leftUpCallback(t.primitive,e):i.leftUpCallback(void 0,e))}),this._etsMap.ScreenSpaceEventType.LEFT_UP)};onRightClick=function(e){let t=this;this.rightClickCallback=e,this.handler.setInputAction((function(e){let i=viewer.scene.pick(e.position),a=t._etsMap.defined(i)?i:void 0;if(a)if(void 0!==a.id&&"point"==a.id.type){let i=a.id.attributes;t.rightClickCallback(a.id,e,i)}else if(null!=a.getProperty&&"tileset"==a.primitive.type){let i=a.primitive.attributes;t.rightClickCallback(a.primitive,e,i)}else if("single"==a.primitive.type){let i=a.primitive.attributes;t.rightClickCallback(a.primitive,e,i)}else t.rightClickCallback(void 0,e);else t.rightClickCallback(void 0,e)}),this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)};onMouseMove=function(e,t,i){let a,o=Object.assign({featureName:[],highlightName:[],selectedColor:"",colorAlpha:1,scale:1,movedScale:1.1,CIMMAP_STEP:window.CIMMAP_STEP||1},e),r=this._viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color},this.name="",this.mouseOverCallback=t,this.mouseOutCallback=i;let s=this,g=document.getElementById("locationInformation"),n=r.scene.globe.ellipsoid;this.handler.setInputAction((function(e){let t=r.camera.pickEllipsoid(e.endPosition,n);if(t&&g){let e=n.cartesianToCartographic(t),i=s._etsMap.Math.toDegrees(e.longitude),a=s._etsMap.Math.toDegrees(e.latitude),o=r.camera.positionCartographic.height.toFixed(2),C=s._etsMap.Math.toDegrees(r.scene.camera.pitch);g.innerHTML="\u7ecf\u5ea6\uff1a"+i+" \u7eac\u5ea6\uff1a"+a+" \u89c6\u89d2\u6d77\u62d4\u9ad8\u5ea6\uff1a"+o+"\u7c73 \u4ef0\u89d2\uff1a"+C}let i=r.scene.pick(e.endPosition);if(s._etsMap.defined(s.highlighted.feature)&&o.selectedColor&&(s.highlighted.feature.color=s.highlighted.originalColor,s.highlighted.feature.primitive.color=s.highlighted.originalColor,s.highlighted.feature=void 0),s._etsMap.defined(a)){let e=a.attributes?a.attributes.scale*o.CIMMAP_STEP:void 0,t=e||o.scale*o.CIMMAP_STEP;"animPoint"!=a.name&&(a.billboard.scale=t,a.billboard.color=s._etsMap.Color.WHITE)}if(s._etsMap.defined(i)){let t=o.featureName.length;if(null!=i.getProperty&&"tileset"==i.primitive.type){if(s.name=i.getProperty("name"),!(t>0)){if(i!==s.selected.feature&&(s.highlighted.feature=i,o.selectedColor&&(s._etsMap.Color.clone(i.color,s.highlighted.originalColor),i.color=s._etsMap.Color.fromAlpha(s._etsMap.Color.fromCssColorString(o.selectedColor),parseFloat(o.colorAlpha))),s.mouseOverCallback)){let t=i.primitive.attributes;return t.featureName=s.name,void s.mouseOverCallback(i.primitive,e,t)}return!1}if(-1==o.featureName.indexOf(s.name)&&s.mouseOutCallback)return void s.mouseOutCallback(void 0);o.featureName.map((function(t){if(s.name===t&&i!==s.selected.feature&&(s.highlighted.feature=i,o.selectedColor&&(s._etsMap.Color.clone(i.color,s.highlighted.originalColor),i.color=s._etsMap.Color.fromAlpha(s._etsMap.Color.fromCssColorString(o.selectedColor),parseFloat(o.colorAlpha))),s.mouseOverCallback)){let t=i.primitive.attributes;return t.featureName=s.name,void s.mouseOverCallback(i.primitive,e,t)}}))}else if(i!==s.selected.feature&&"single"==i.primitive.type){if(o.featureName.length>0){if(-1!=o.featureName.indexOf(i.id)){if(s.highlighted.feature=i,o.selectedColor&&(s._etsMap.Color.clone(i.primitive.color,s.highlighted.originalColor),i.primitive.color=s._etsMap.Color.fromAlpha(s._etsMap.Color.fromCssColorString(o.selectedColor),parseFloat(o.colorAlpha))),s.mouseOverCallback)return void s.mouseOverCallback(i.primitive,e,i.primitive.attributes)}else if(s.mouseOutCallback)return void s.mouseOutCallback(void 0)}else if(s.highlighted.feature=i,o.selectedColor&&(s._etsMap.Color.clone(i.primitive.color,s.highlighted.originalColor),i.primitive.color=s._etsMap.Color.fromAlpha(s._etsMap.Color.fromCssColorString(o.selectedColor),parseFloat(o.colorAlpha))),s.mouseOverCallback)return void s.mouseOverCallback(i.primitive,e,i.primitive.attributes)}else if(void 0!==i.id&&"point"==i.id.type){if(s._etsMap.defined(i.id.billboard)){a=i.id;let e=a.attributes?a.attributes.scale*o.CIMMAP_STEP:void 0,t=e||o.scale*o.CIMMAP_STEP,r=a.attributes?a.attributes.movedScale*o.CIMMAP_STEP:void 0,g=1==o.CIMMAP_STEP?.1:.01,n=r||Number(t*o.CIMMAP_STEP)+g;"animPoint"!=a.name&&(i.id.billboard.scale=n,i.id.billboard.color=s._etsMap.Color.WHITE)}if(s.mouseOverCallback){let t=i.id.attributes;if(!(o.featureName.length>0))return void s.mouseOverCallback(i.id,e,t);if(-1!=o.featureName.indexOf(i.id.id))return void s.mouseOverCallback(i.id,e,t)}}}else if(s.mouseOutCallback)return void s.mouseOutCallback(void 0)}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)};listenerEvent=function(e,t){let i=this._viewer;this.listenerCallback=t;let a=this;i.scene.camera.percentageChanged=0,i.scene.camera.changed.addEventListener((function(){if("object"==typeof e.DOMElement){let t="none";t=e.DOMElement[0]?e.DOMElement[0].style.display:e.DOMElement.style.display,a.listenerCallback&&"none"!==t&&a.listenerCallback(e)}else{let t=document.getElementById(e.DOMElement);null!=t&&a.listenerCallback&&"none"!==t.style.display&&a.listenerCallback(e)}})),i.scene.camera.moveEnd.addEventListener((function(){if("object"==typeof e.DOMElement){let t="none";t=e.DOMElement[0]?e.DOMElement[0].style.display:e.DOMElement.style.display,a.listenerCallback&&"none"!==t&&a.listenerCallback(e)}else{let t=document.getElementById(e.DOMElement);null!=t&&a.listenerCallback&&"none"!==t.style.display&&a.listenerCallback(e)}}))};unbindEvent=function(e){switch(e){case"LEFT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}}}class EtsTips{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.etsEvent=new EtsEvent,this.options={}}create(e){this.options[e.id]?this.options[e.id]=Object.assign({},this.options[e.id],e):this.options[e.id]=Object.assign({},{id:"",title:"",attr:{},offsetY:0,offsetX:0,closeBtn:!1,html:"",height:0,class:"",horizontalOrigin:"CENTER"},e),this.createNode(this.options[e.id]),this.options[e.id].elemWidth=this.options[e.id].elem.offsetWidth,this.options[e.id].elemHeight=this.options[e.id].elem.offsetHeight,this.options[e.id].elem.style.display="block",this.setPosition(this.options[e.id]),this.listener(this.options[e.id])}bindCloseEvent=function(e){let t=document.getElementById(e);if(null!==t){let i=document.getElementById("cimMap_popup_"+e);null!==i&&(i.onclick=function(){t.style.display="none"})}};createNode=function(e){let t="";for(let i in e.attr)""!=i&&(t+="<div><label>"+i+"</label>"+e.attr[i]+"</div>");let i="",a='<div class="cimMap-popup-title">'+e.title+'</div><div class="cimMap-popup-content">'+t+"</div>";if(this.options[e.id].elem)e.html.length>0?document.getElementById(e.id).innerHTML=e.html:document.getElementById(e.id+"_tip_content").innerHTML=a;else{e.closeBtn&&(i+='<a id="cimMap_popup_'+e.id+'" class="cimMap-popup-close-button">\xd7</a>'),i+='<div class="cimMap-popup-content-wrapper cimMap-popup-background">',i+='<div class="cimMap-popup-content cimMap-popup-color" id='+e.id+"_tip_content>",i+=a,i+="</div>",i+=" </div>",i+='<div class="cimMap-popup-tip-container">',i+=' <div class="cimMap-popup-tip cimMap-popup-background"></div>',i+="</div>",e.html.length>0&&(i="",i+=e.html);let t=document.createElement("div");t.setAttribute("id",e.id),t.setAttribute("class","cimMap-popup cimMap-fixed-popup "+e.class),t.style.display="none",t.innerHTML=i,window.document.body.appendChild(t),this.options[e.id].elem=document.getElementById(e.id)}e.closeBtn&&this.bindCloseEvent(e.id)};show=function(e){this.create(e)};hide=function(e){let t=document.getElementById(e);null!==t&&(t.style.display="none")};remove=function(e){if(e){let t=document.getElementById(e);null!==t&&(document.body.removeChild(t),delete this.options[e])}else for(e in this.options){let t=document.getElementById(e);null!==t&&(document.body.removeChild(t),delete this.options[e])}};conversion=function(e){let t=new this._etsMap.Cartesian2;e.longitude&&e.latitude||(e.longitude=0,e.latitude=0);let i=this._etsMap.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height),a=this._viewer.scene.cartesianToCanvasCoordinates(i,t);if(e.position&&(a=e.position),a){let t=a.x,i=a.y,o=e.elemWidth?e.elemWidth:this.options[e.id].elem.offsetWidth,r=e.elemHeight?e.elemHeight:this.options[e.id].elem.offsetHeight,s=e.offsetY?e.offsetY:this.options[e.id].offsetY,g=e.offsetX?e.offsetX:this.options[e.id].offsetX;this.options[e.id].longitude=e.longitude,this.options[e.id].latitude=e.latitude,this.options[e.id].height=e.height;let n=document.getElementsByClassName("cesium-viewer")[0].parentNode,C=n.getBoundingClientRect().left,l=n.getBoundingClientRect().top;if(r&&o)switch(i=i-r+l+s,this.options[e.id].horizontalOrigin){case"LEFT":t=t-o+C+g;break;case"RIGHT":t=t+C+g;break;case"CENTER":t=t-o/2+C+g}return{left:t,top:i}}};setPosition(e){this._viewer.camera.positionCartographic.height;let t=this.conversion(e);if(t){let i="translate("+parseFloat(t.left)+"px,"+parseFloat(t.top)+"px)",a=document.getElementById(e.id);null!=a&&(a.style.transform=i)}}listener=function(e){let t=this,i=this.options;this.etsEvent.listenerEvent({DOMElement:e.elem},(function(){for(let e in i){let a=i[e];t.setPosition(a)}}))}}class DynamicWall{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}fromTopToBottom="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = 0.4*materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(-(st.t + time)), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromBottomToTop="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = 0.4*materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(st.t - time), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromRightToLeft="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(-(st.s + time)), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromLeftToRight="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";getMaterial(e,t,i){return new this._etsMap.Material({fabric:{uniforms:{color:this._etsMap.Color.fromCssColorString("#7ffeff"),image:"/apps/demo/assets/images/img/fire.png",time:1e3},source:this.fromBottomToTop},translucent:function(){return!0}})}setTrailLinkMaterialProperty(e){this._etsMap.PolylineTrailLinkMaterialProperty=PolylineTrailLinkMaterialProperty,this._etsMap.Material.PolylineTrailLinkType="PolylineTrailLink",this._etsMap.Material.PolylineTrailLinkImage="./img/LinkPulse.png",this._etsMap.Material.PolylineTrailLinkSource=e,this._etsMap.Material._materialCache.addMaterial(this._etsMap.Material.PolylineTrailLinkType,{fabric:{type:this._etsMap.Material.PolylineTrailLinkType,uniforms:{color:new this._etsMap.Color(1,0,0,.5),image:this._etsMap.Material.PolylineTrailLinkImage,time:100},source:this._etsMap.Material.PolylineTrailLinkSource},translucent:function(e){return!0}})}addDynamicWall(e){e.positions=[118.286419,31.864436,2e4,119.386419,31.864436,2e4,119.386419,32.864436,2e4,118.286419,32.864436,2e4,118.286419,31.864436,2e4];var t=new this._etsMap.PolylineMaterialAppearance;t.material=this.getMaterial(1,2,this.fromBottomToTop),this._viewer.scene.primitives.add(new this._etsMap.Primitive({geometryInstances:new this._etsMap.GeometryInstance({geometry:new this._etsMap.PolylineGeometry({positions:this._etsMap.Cartesian3.fromDegreesArrayHeights(e.positions),width:30})}),appearance:t}))}}class DynamicWallEntity{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}fromTopToBottom="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = 0.4*materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(-(st.t + time)), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromBottomToTop="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = 0.4*materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(st.t - time), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromRightToLeft="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(-(st.s + time)), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";fromLeftToRight="czm_material czm_getMaterial(czm_materialInput materialInput)\n    {\n        czm_material material = czm_getDefaultMaterial(materialInput);\n        vec2 st = materialInput.st;\n        vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n        material.alpha = colorImage.a * color.a;\n        material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n        return material;\n    }";setTrailLinkMaterialProperty(e){function t(e,t){this._etsMap=EtsMapApi.getApi(),this._definitionChanged=new this._etsMap.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e,this.duration=t,this._time=(new Date).getTime()}Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),t.prototype.getType=function(e){return"PolylineTrailLink"},t.prototype.getValue=function(e,t){return this._etsMap.defined(t)||(t={}),t.color=this._etsMap.Property.getValueOrClonedDefault(this._color,e,this._etsMap.Color.WHITE,t.color),t.image=this._etsMap.Material.PolylineTrailLinkImage,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},t.prototype.equals=function(e){return this===e||e instanceof t&&Property.equals(this._color,e._color)},this.PolylineTrailLinkMaterialProperty=t,this._etsMap.Material.PolylineTrailLinkType="PolylineTrailLink",this._etsMap.Material.PolylineTrailLinkSource=e,this._etsMap.Material._materialCache.addMaterial(this._etsMap.Material.PolylineTrailLinkType,{fabric:{type:this._etsMap.Material.PolylineTrailLinkType,uniforms:{color:new this._etsMap.Color(1,0,0,.9),image:this._etsMap.Material.PolylineTrailLinkImage,time:100},source:this._etsMap.Material.PolylineTrailLinkSource},translucent:function(e){return!0}})}getType(e){switch(e){case 1:return this.fromBottomToTop;case 2:return this.fromTopToBottom;case 3:default:return this.fromLeftToRight;case 4:return this.fromRightToLeft}}addDynamicWall(e){return this._etsMap.Material.PolylineTrailLinkImage=e.imageUrl||"../assets/images/img/smoke.png",this.setTrailLinkMaterialProperty(this.getType(e.type)),null!=this.three&&(this._viewer.entities.remove(three),three=null),this.three=this._viewer.entities.add({name:"yscNoNeedEntity",wall:{positions:this._etsMap.Cartesian3.fromDegreesArrayHeights(e.positions),material:new this.PolylineTrailLinkMaterialProperty(this._etsMap.Color.BLUE,e.duration||2e4),width:100}}),this.three}}class MarkerLayer{opts={id:"",show:!0,height:0,longitude:113.776084923,latitude:23.02785011,pixelSize:5,outlineColor:"#ff9900",outlineWidth:1,alpha:1,url:"",scale:1,CIMMAP_STEP:window.CIMMAP_STEP||1,movedScale:1.1,attributes:"",pinSize:48,color:"#ff9900",text:"\u6587\u672c",textColor:"#ffffff",font:"14pt Helvetica",backgroundColor:"#000000",showBackground:!1,key:"",attr:{},scaleByDistance:!1,maxScaleDistance:5e4,maxScale:1,minScaleDistance:1e3,minScale:0,minDistanceDisplay:0,maxDistanceDisplay:1e4,offsetX:0,offsetY:0};constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.poiEntities=[],this.poiJson=[],this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas)}addPoint(e){let t=Object.assign({},this.opts,e);t.color=t.color||this._etsMap.Color.BLUE;let i={attributes:t,name:"point",type:"point",position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),cimLayerId:this.layerId,show:t.show,key:t.key,point:{pixelSize:t.pixelSize*t.CIMMAP_STEP,color:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.alpha)),outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),outlineWidth:t.outlineWidth*t.CIMMAP_STEP,height:t.height,verticalOrigin:this._etsMap.VerticalOrigin.CENTER,horizontalOrigin:this._etsMap.HorizontalOrigin.CENTER}};switch(this._viewer.scene.mode){case 2:i.point.verticalOrigin=this._etsMap.VerticalOrigin.CENTER,i.point.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER;break;case 3:i.point.verticalOrigin=this._etsMap.VerticalOrigin.BOTTOM,i.point.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER}switch(t.vertical){case"center":i.point.verticalOrigin=this._etsMap.VerticalOrigin.CENTER;break;case"left":i.point.verticalOrigin=this._etsMap.VerticalOrigin.LEFT}switch(t.horizontal){case"center":i.point.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER;break;case"left":i.point.horizontalOrigin=this._etsMap.HorizontalOrigin.LEFT}t.scaleByDistance&&(i.point.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.scale,t.maxScaleDistance,.1),i.point.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay)),t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.poiEntities.push(a),a}addText(e){let t=Object.assign({},{offsetX:10,offsetY:0,vertical:"center",horizontal:"center"},this.opts,e);t.color=t.color||this._etsMap.Color.BLUE;let i={attributes:t,name:"pointLabel",type:"point",position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),cimLayerId:this.layerId,show:t.show,key:t.key,label:{scale:t.scale*t.CIMMAP_STEP,text:t.text,font:t.font,fillColor:this._etsMap.Color.fromCssColorString(t.color),backgroundColor:this._etsMap.Color.fromCssColorString(t.backgroundColor),showBackground:t.showBackground,style:this._etsMap.LabelStyle.FILL,outlineWidth:2,verticalOrigin:this._etsMap.VerticalOrigin.CENTER,horizontalOrigin:this._etsMap.HorizontalOrigin.CENTER,pixelOffset:new this._etsMap.Cartesian2(t.offsetX,t.offsetY),height:t.height}};switch(t.vertical){case"center":i.label.verticalOrigin=this._etsMap.VerticalOrigin.CENTER;break;case"bottom":i.label.verticalOrigin=this._etsMap.VerticalOrigin.BOTTOM}switch(t.horizontal){case"center":i.label.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER;break;case"left":i.label.horizontalOrigin=this._etsMap.HorizontalOrigin.LEFT}t.scaleByDistance&&(i.label.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.scale,t.maxScaleDistance,.1),i.label.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay)),t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.poiEntities.push(a),a}addIcon(e){let t=Object.assign({},this.opts,e),i={name:"pointIcon",type:"point",show:t.show,attributes:t,key:t.key,cimLayerId:this.layerId,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),billboard:{scale:t.scale*t.CIMMAP_STEP,image:t.url,sizeInMeters:!1,verticalOrigin:this._etsMap.VerticalOrigin.BOTTOM,horizontalOrigin:this._etsMap.HorizontalOrigin.CENTER}};switch(this._viewer.scene.mode){case 2:i.billboard.verticalOrigin=this._etsMap.VerticalOrigin.CENTER,i.billboard.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER;break;case 3:i.billboard.verticalOrigin=this._etsMap.VerticalOrigin.BOTTOM,i.billboard.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER}switch(t.vertical){case"center":i.billboard.verticalOrigin=this._etsMap.VerticalOrigin.CENTER;break;case"bottom":i.billboard.verticalOrigin=this._etsMap.VerticalOrigin.BOTTOM}switch(t.horizontal){case"center":i.billboard.horizontalOrigin=this._etsMap.HorizontalOrigin.CENTER;break;case"left":i.billboard.horizontalOrigin=this._etsMap.HorizontalOrigin.LEFT}t.scaleByDistance&&(i.billboard.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.scale,t.maxScaleDistance,.1),i.billboard.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay)),t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.poiEntities.push(a),a}animationDOMPoint(e){let t=Object.assign({},this.opts,e);this._viewer;let i=this;function a(e){let t=new i._etsMap.Cartesian2,a=Number(e.longitude),o=Number(e.latitude),r=Number(e.height),s=i._etsMap.Cartesian3.fromDegrees(a,o,r),g=i._viewer.scene.cartesianToCanvasCoordinates(s,t);return"translate3d("+g.x+"px,"+g.y+"px, 0px)"}let o=a(t),r=t.longitude+","+t.latitude+","+t.height,s='<div class="cim-animation-point" style="color:'+t.color+'"><span></span></div>',g=document.createElement("div");g.setAttribute("id",t.id),g.setAttribute("class","cim-anim-point-wp"),g.setAttribute("data-pos",r),g.style.transform=o,g.innerHTML=s,window.document.body.appendChild(g),this._viewer.scene.camera.percentageChanged=0;let n=document.getElementById(t.id);function C(e){try{let t=e,i=t.getAttribute("data-pos").split(","),o=a({longitude:i[0],latitude:i[1],height:i[2]});t.style.transform=o}catch(e){}}this._viewer.scene.camera.changed.addEventListener((function(){void 0!==n&&C(n)})),this._viewer.scene.camera.moveEnd.addEventListener((function(){"undefined"!=typeof elements&&C(n)}))}animationPoint(e){let t=Object.assign({},this.opts,{step:.02,color:"#fa0130",size:8,url:"data:image/png;base64,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eGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjAtMDYtMThUMTQ6NDE6MTUrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjAtMDYtMTlUMDk6NDU6NTUrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIwLTA2LTE5VDA5OjQ1OjU1KzA4OjAwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjMzMjdjYTc0LTI5NTktNGE4Yi1hNWNhLTk0YzNhOGU4YTcwNiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmM5MzU4MDUxLTVjMjUtNGI0MS1iNGE4LWUxN2FiZDUyOTRlZSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmY0OWIxNGJjLTQ3NmUtNGE1MS1iMDA5LTNjZmYwMmVkZjQ2MSIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJEaXNwbGF5IiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249IjQwIiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNDAiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+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"},e),i=t.scale,a=!1;EtsMapApi.getApi().CallbackProperty;let o={name:"animPoint",type:"point",show:t.show,attributes:t,cimLayerId:this.layerId,key:t.key,position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),billboard:{scale:new this._etsMap.CallbackProperty((function(){return a?(i-=t.step,i<=t.scale&&(a=!1)):(i+=.015,i>=t.maxScale*t.CIMMAP_STEP+.1&&(a=!0)),i}),!1),image:t.url,verticalOrigin:this._etsMap.VerticalOrigin.CENTER},point:{show:!0,color:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.alpha)),pixelSize:Number(t.size*t.CIMMAP_STEP),outlineWidth:1,height:.1,outlineColor:this._etsMap.Color.WHITE}};t.scaleByDistance&&(o.billboard.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.maxScale,t.maxScaleDistance,.1),o.billboard.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay),o.point.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.maxScale,t.maxScaleDistance,.1),o.point.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay)),t.id&&(o.id=t.id),console.log(o);let r=this._viewer.entities.add(o);return this.poiEntities.push(r),r}addPointLabel(e){let t=Object.assign({},this.opts,e);t.color=t.color||this._etsMap.Color.BLUE;let i={attributes:t,name:"pointLabel",type:"point",position:this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),cimLayerId:this.layerId,show:t.show,key:t.key,label:{scale:t.scale*t.CIMMAP_STEP,text:t.text,font:t.font,fillColor:this._etsMap.Color.fromCssColorString(t.textColor),showBackground:t.showBackground,backgroundColor:this._etsMap.Color.fromCssColorString(t.backgroundColor),style:this._etsMap.LabelStyle.FILL,outlineWidth:2,verticalOrigin:this._etsMap.VerticalOrigin.CENTER,horizontalOrigin:this._etsMap.HorizontalOrigin.CENTER,pixelOffset:new this._etsMap.Cartesian2(t.offsetX*t.CIMMAP_STEP,t.offsetY*t.CIMMAP_STEP),height:t.height,eyeOffset:new this._etsMap.Cartesian3(0,0,-1)},point:{pixelSize:t.pixelSize*t.CIMMAP_STEP,color:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.alpha)),outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor),outlineWidth:t.outlineWidth*t.CIMMAP_STEP,height:t.height}};t.scaleByDistance&&(i.label.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.scale,t.maxScaleDistance,.1),i.label.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay),i.point.scaleByDistance=new this._etsMap.NearFarScalar(t.minScaleDistance,t.scale,t.maxScaleDistance,.1),i.point.distanceDisplayCondition=new this._etsMap.DistanceDisplayCondition(t.minDistanceDisplay,t.maxDistanceDisplay)),t.id&&(i.id=t.id);let a=this._viewer.entities.add(i);return this.poiEntities.push(a),a}addMorePoint(e){let t=Object.assign({},this.opts,{position:[]},e),i=[],a=this;return t.position.map((function(e){let o;e.url||(e.url=t.url),o=e.url?a.addIcon(e):a.addPoint(e),i.push(o),a.poiEntities.push(o)})),i}PointCluster(e){this.combineIconAndLabel(e).then((e=>{console.log(e.toDataURL());var t=camera._viewer.entities.add({name:"Blank blue pin",position:new camera._etsMap.Cartesian3.fromDegrees(120,30,0),billboard:{image:e.toDataURL(),verticalOrigin:camera._etsMap.VerticalOrigin.BOTTOM}});camera.flyToEntity(t)}))}clusterPoi(e){this.addPointByJson(e)}combineIconAndLabel_bak(e,t,i,a){let o=document.createElement("canvas");o.width=i,o.height=i;let r=o.getContext("2d");var s=new Image;s.src=e;try{s.onload=function(){r.drawImage(this,0,0)}}catch(e){console.log(e)}return a=a||{},r.fillStyle=a.color||this._etsMap.Color.WHITE.toCssColorString(),r.font=a.font||"bold 20px Microsoft YaHei",r.textAlign=a.textAlign||"center",r.textBaseline=a.textBaseline||"middle",r.fillText(t,i/2,i/2),o}combineIconAndLabel(e,t){let i=e.size,a=e.leftOffset||0,o=e.topOffset||0,r=document.createElement("canvas");r.width=i,r.height=i;let s=r.getContext("2d");return new this._etsMap.Resource.fetchImage(e.url).then((g=>{try{s.drawImage(g,0,0,i,i)}catch(e){console.log(e)}return t=t||{},s.fillStyle=t.color||this._etsMap.Color.WHITE.toCssColorString(),s.font=t.font||"bold 20px Microsoft YaHei",s.textAlign=t.textAlign||"center",s.textBaseline=t.textBaseline||"middle",s.fillText(e.text,i/2-a,i/2-o),r}))}addPointByJson(e){let t=Object.assign({},this.opts,{dataUrl:"PoiByJson.json",iconUrl:"",pixelRange:50,minimumClusterSize:10,enabled:!0,clusterScale:.3},e),i=this,a=this._viewer.dataSources.add(this._etsMap.GeoJsonDataSource.load(t.dataUrl,{camera:this._viewer.scene.camera,canvas:this._viewer.scene.canvas}));return a.then((function(e){let a,o=t.pixelRange,r=t.minimumClusterSize,s=t.enabled;e.clustering.enabled=s,e.clustering.pixelRange=o,e.clustering.minimumClusterSize=r,t.id&&(e.id=t.id),e.entities.values.map((function(e){e.type="point",e.key=t.key,e.billboard={scale:t.scale,image:t.iconUrl,verticalOrigin:i._etsMap.VerticalOrigin.BOTTOM,show:!0}})),new i._etsMap.PinBuilder,function(t,o){i._etsMap.defined(a)?(a(),a=void 0):a=e.clustering.clusterEvent.addEventListener((function(e,t){t.label.show=!1,t.billboard.show=!0,t.billboard.id=t.label.id,t.billboard.verticalOrigin=i._etsMap.VerticalOrigin.BOTTOM,function(e,t,i,a){e.billboard.image="../assets/images/02.png",e.billboard.scale=a}(t,e.length,0,o)}));let r=e.clustering.pixelRange;e.clustering.pixelRange=0,e.clustering.pixelRange=r}(t.iconUrl,t.clusterScale)})),a}remove(e){let t=this._viewer,i=e,a=this;if(e)if(i instanceof Object)this._etsMap.when(i,(function(e){i.then((function(e){e.entities.values.map((function(e){t.entities.removeById(e.id),e.billboard.show=!1}))}))}));else{e.split(",").map((function(e){Tool.isExsitEntityId(t,e)&&(a.poiEntities.map((function(t){t.id==e&&Tool.delArr(a.poiEntities,t)})),t.entities.removeById(e)),t.dataSources._dataSources.map((function(i){i.id==e&&t.dataSources.remove(i)}))}))}else this.poiEntities.map((function(e){t.entities.removeById(e._id)})),this.poiEntities=[]}show(e){let t=this._viewer,i=this;if(e){e.split(",").map((function(e){Tool.isExsitEntityId(t,e)&&i.poiEntities.map((function(t){e==t.id&&(t.show=!0)})),t.dataSources._dataSources.map((function(t){t.id==e&&(t.show=!0)}))}))}else this.poiEntities.map((function(e){e.show=!0}))}hide(e){let t=this._viewer,i=this;if(e){e.split(",").map((function(e){Tool.isExsitEntityId(t,e)&&i.poiEntities.map((function(t){e==t.id&&(t.show=!1)})),t.dataSources._dataSources.map((function(t){t.id==e&&(t.show=!1)}))}))}else this.poiEntities.map((function(e){e.show=!1}))}showCoordinates(e){let t=Object.assign({},{movement:[]},e),i=this._viewer,a=i.scene.globe.ellipsoid,o=i.entities.add({label:{show:!1}}),r=i.camera.pickEllipsoid(t.movement.endPosition,a);if(r){let e=a.cartesianToCartographic(r),t=this._etsMap.Math.toDegrees(e.longitude),s=this._etsMap.Math.toDegrees(e.latitude),g=Math.ceil(i.camera.positionCartographic.height);o.position=r,o.label.show=!1,o.label.text="("+t+", "+s+","+g+")"}}get(e){return this._viewer.entities.getById(e)}isExsitId(e){return null!=this._viewer.entities.getById(e)}changeTarget(e,t){let i=e.attributes?e.attributes.scale*t.CIMMAP_STEP:void 0,a=i||t.scale*t.CIMMAP_STEP,o=e.attributes?e.attributes.movedScale*t.CIMMAP_STEP:void 0,r=1==t.CIMMAP_STEP?.1:.01,s=o||Number(a*t.CIMMAP_STEP)+r;"animPoint"!==e.name&&"pointLabel"!==e.name&&"point"!==e.name&&(e.billboard.scale=s,e.billboard.color=this._etsMap.Color.WHITE)}onMouseMove(e,t,i){let a=null,o=null,r=null;if(arguments.length<2)return;if(2===arguments.length){if("function"!=typeof arguments[0]||"function"!=typeof arguments[1])return;a=arguments[0],o=arguments[1],r={}}else a=t,o=i,r=e;let s=Object.assign({includeElemName:[],excludeElemName:[],CIMMAP_STEP:window.CIMMAP_STEP||1},r),g=this._viewer,n=this,C=null;this.handler.setInputAction((function(e){let t=g.scene.pick(e.endPosition);if(n._etsMap.defined(C)){let e=C.attributes?C.attributes.scale*s.CIMMAP_STEP:void 0,t=e||s.scale*s.CIMMAP_STEP;"animPoint"!==C.name&&"pointLabel"!==C.name&&"point"!==C.name&&(C.billboard.scale=t,C.billboard.color=n._etsMap.Color.WHITE)}if(n._etsMap.defined(t)){if(void 0!==t.id&&"point"==t.id.type){if(C=t.id,-1==n.poiEntities.indexOf(C))return;let i=C.id;if(s.excludeElemName.length>0)return-1==s.excludeElemName.indexOf(i)?(n.changeTarget(C,s),void a(C,e,C.attributes)):void o(C);if(!(s.includeElemName.length>0))return n.changeTarget(C,s),void a(C,e,C.attributes);if(-1==s.includeElemName.indexOf(i))return void o(C);s.includeElemName.map((function(t){if(i===t)return n.changeTarget(C,s),void a(C,e,C.attributes)}))}}else o(C)}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)}onClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({includeElemName:[],excludeElemName:[],CIMMAP_STEP:window.CIMMAP_STEP||1},a),r=this._viewer,s=this,g=null;this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(s._etsMap.defined(g)){let e=g.attributes?g.attributes.scale*o.CIMMAP_STEP:void 0,t=e||o.scale*o.CIMMAP_STEP;"animPoint"!==g.name&&"pointLabel"!==g.name&&"point"!==g.name&&(g.billboard.scale=t,g.billboard.color=s._etsMap.Color.WHITE)}if(s._etsMap.defined(t)&&void 0!==t.id&&"point"==t.id.type){if(g=t.id,-1==s.poiEntities.indexOf(g))return;let a=g.id;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a))return s.changeTarget(g,o),void i(g,e,g.attributes)}else{if(!(o.includeElemName.length>0))return s.changeTarget(g,o),void i(g,e,g.attributes);if(-1!==o.includeElemName.indexOf(a))return s.changeTarget(g,o),void i(g,e,g.attributes)}}}),this._etsMap.ScreenSpaceEventType.LEFT_CLICK)}onRightClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({includeElemName:[],excludeElemName:[],CIMMAP_STEP:window.CIMMAP_STEP||1},a),r=this._viewer,s=this,g=null;this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(this._etsMap.defined(g)){let e=g.attributes?g.attributes.scale*o.CIMMAP_STEP:void 0,t=e||o.scale*o.CIMMAP_STEP;"animPoint"!==g.name&&"pointLabel"!==g.name&&"point"!==g.name&&(g.billboard.scale=t,g.billboard.color=this._etsMap.Color.WHITE)}if(this._etsMap.defined(t)&&void 0!==t.id&&"point"==t.id.type){if(g=t.id,-1==s.poiEntities.indexOf(g))return;let a=g.id;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a))return s.changeTarget(g,o),void i(g,e,g.attributes)}else{if(!(o.includeElemName.length>0))return s.changeTarget(g,o),void i(g,e,g.attributes);if(-1!==o.includeElemName.indexOf(a))return s.changeTarget(g,o),void i(g,e,g.attributes)}}}),this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}unbindEvent(e){switch(e){case"LEFT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}}}class ImageryLayer{opts={brightness:1,contrast:1,hue:0,saturation:1,gamma:1,alpha:1,show:!0,remove:!1};selectedLine=null;constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.scene.canvas)}get(){return this._viewer.scene.imageryLayers}getByOrder(e){return this._viewer.scene.imageryLayers.get(e)}getLength(){return this._viewer.scene.imageryLayers.length}setImageStyle(e,t){let i,a=this._viewer.scene.imageryLayers;return t.remove&&a.removeAll(),t.order?(i=new this._etsMap.ImageryLayer(e),i.attr={id:t.id,order:t.order},a.add(i,t.order)):(i=a.addImageryProvider(e),i.attr={id:t.id}),i&&(t.brightness&&(i.brightness=t.brightness),t.contrast&&(i.contrast=t.contrast),t.hue&&(i.hue=t.hue),t.saturation&&(i.saturation=t.saturation),t.gamma&&(i.gamma=t.gamma),t.alpha&&(i.alpha=t.alpha),i.show=t.show),i.baseImagery=e,i}showTileCoordinatesImagery(){this.tileCoordinates=new this._etsMap.TileCoordinatesImageryProvider;var e=this._viewer.imageryLayers.addImageryProvider(this.tileCoordinates);this.tileCoordinatesLayer=e,this._viewer.scene.imageryLayers.raiseToTop(e)}hideTileCoordinatesImagery(){this.remove(this.tileCoordinatesLayer)}loadImageryProvider(e){let t=Object.assign({},this.opts,e);if(t.type)switch(t.type){case 1:return this.loadArcGisMap(t);case 2:return this.loadOpenStreetMap(t);case 3:return this.loadMapbox(t);case 4:return this.loadBingMap(t);case 5:return this.loadWebMapTileService(t);case 6:return this.loadTerrainProvider(t);case 7:return this.loadSingleTileImageryProvider(t);case 8:return this.loadUrlTemplateImagery(t)}}loadArcGisMap(e){let t=Object.assign({id:"ArcGisMap"},this.opts,e),i=new this._etsMap.ArcGisMapServerImageryProvider({url:t.url||"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",enablePickFeatures:t.enablePickFeatures||!1});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}loadOpenStreetMap(e){let t=Object.assign({id:"OpenStreetMap"},this.opts,e),i=new this._etsMap.OpenStreetMapImageryProvider({url:t.url||"https://a.tile.openstreetmap.org/"});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}loadMapbox(e){let t=Object.assign({id:"Mapbox"},this.opts,e),i=new this._etsMap.MapboxImageryProvider({mapId:"mapbox.streets"});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}loadBingMap(e){let t=Object.assign({id:"BingMap"},this.opts,e),i=new this._etsMap.BingMapsImageryProvider({url:t.url||"https://dev.virtualearth.net",key:t.key||"get-yours-at-https://www.bingmapsportal.com/",mapStyle:t.mapStyle||this._etsMap.BingMapsStyle.AERIAL});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}loadWebMapTileService(e,t){let i=Object.assign({id:"WebMapTileService"},this.opts,e),a=new this._etsMap.WebMapTileServiceImageryProvider({url:i.url||"//t0.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=ebf64362215c081f8317203220f133eb",layer:"tdtBasicLayer",style:"default",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible",show:!0});return i.attr&&(a.attr=i.attr),this.setImageStyle(a,i)}loadWebMapService(e,t){let i=Object.assign({id:"WebMapService"},this.opts,e),a=new this._etsMap.WebMapServiceImageryProvider(i);return i.attr&&(a.attr=i.attr),this.setImageStyle(a,i)}loadTerrainProvider(e,t){let i=Object.assign({id:"TerrainProvider"},this.opts,e),a=this._viewer.terrainProvider=new this._etsMap.CesiumTerrainProvider({url:i.url||"//assets.agi.com/stk-terrain/world",requestWaterMask:!0,requestVertexNormals:!1});return this._viewer.scene.globe.depthTestAgainstTerrain=!0,i.attr&&(a.attr=i.attr),this.setImageStyle(a,i)}loadSingleTileImageryProvider(e){let t=Object.assign({id:"SingleTileImageryProvider"},this.opts,e),i=new this._etsMap.SingleTileImageryProvider({url:t.url||""});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}loadUrlTemplateImagery(e){let t=Object.assign({id:"UrlTemplateImagery"},this.opts,e),i=new this._etsMap.UrlTemplateImageryProvider({url:t.url||"//mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}&s=Gali"});return t.attr&&(i.attr=t.attr),this.setImageStyle(i,t)}remove(e){let t=this._viewer.imageryLayers;e?(e instanceof Object&&t.remove(e),t._layers.map((function(i){void 0!==i&&void 0!==i.attr&&i.attr.id==e&&t.remove(i)}))):t.removeAll()}edit(e){let t=this._viewer.imageryLayers,i=Object.assign({layerIndex:""},this.opts,e);t._layers.map((function(e){void 0!==e&&void 0!==e.attr&&e.attr.id==i.id&&(e.brightness=i.brightness,e.contrast=i.contrast,e.hue=i.hue,e.saturation=i.saturation,e.gamma=i.gamma,e.alpha=i.alpha,e.show=i.show)}))}onWheel(e){let t=this;this.handler.setInputAction((function(i){let a=t.viewer.camera.positionCartographic.height;e&&e({height:a})}),this._etsMap.ScreenSpaceEventType.WHEEL)}onLeftUp(e){let t=this;this.handler.setInputAction((function(i){let a=viewer.camera.getPickRay(i.position),o=viewer.scene.globe.pick(a,viewer.scene),r=new this._etsMap.Cartesian2,s=viewer.camera.positionCartographic.height,g=t.getLevel(s),n=o?this._etsMap.Cartographic.fromCartesian(o):null;e&&e({cartographic:n,xy:r,height:s,level:g})}),this._etsMap.ScreenSpaceEventType.LEFT_UP)}getLevel(e){return e>48e6?0:e>24e6?1:e>12e6?2:e>6e6?3:e>3e6?4:e>15e5?5:e>75e4?6:e>375e3?7:e>187500?8:e>93750?9:e>46875?10:e>23437.5?11:e>11718.75?12:e>5859.38?13:e>2929.69?14:e>1464.84?15:e>732.42?16:e>366.21?17:18}addAreaHighlighted(e){let t=Object.assign({},{position:[]},e);this.selectedLine=this._viewer.scene.primitives.add(new this._etsMap.Primitive({geometryInstances:new this._etsMap.GeometryInstance({geometry:new this._etsMap.PolylineGeometry({positions:this._etsMap.Cartesian3.fromDegreesArray(t.position),width:2,vertexFormat:this._etsMap.PolylineColorAppearance.VERTEX_FORMAT})}),appearance:new this._etsMap.PolylineMaterialAppearance({material:this._etsMap.Material.fromType(this._etsMap.Material.PolylineDashType,{color:this._etsMap.Color.CYAN,gapColor:this._etsMap.Color.TRANSPARENT,dashLength:20})})}))}removeAreaHighlighted(){this.selectedLine&&this._viewer.scene.primitives.remove(this.selectedLine)}}class TilesLayer{opts={id:"tilesModelId",url:"",color:"#ffffff",opacity:1,selectedColor:"#b4fe03",key:"",maximumScreenSpaceError:2,maximumNumberOfLoadedTiles:1e3,show:!0,originalColorByClick:"",selectedColorByClick:"",selectedFeatureByClick:[],isEntireByLeftClick:null};constructor(e){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.scene.canvas),this.TilesModelPrimitives=[],this.layerId=e,this.isEntire=!1}loadTilesModel(e,t){let i=Object.assign({},this.opts,e),a=new this._etsMap.Cesium3DTileset({url:i.url,maximumScreenSpaceError:i.maximumScreenSpaceError,maximumNumberOfLoadedTiles:i.maximumNumberOfLoadedTiles,show:i.show}),o=this._viewer.scene.primitives.add(a);if(o.type="tileset",o.id=i.id,o.attributes=i,o.key=i.key,o.layerId=this.layerId,/^rgba\(/.test(i.color)){let e=Tools$1.rgbaTo16a(i.color);i.color=e.color,i.opacity=Number(e.alpha)}let r={color:{conditions:[]}};function s(e){let t=e.getProperty("id");o.featureMap.get(t)||o.featureMap.set(t,e)}function g(e,t){for(let i=e.featuresLength-1;i>=0;i--){t(e.getFeature(i))}}void 0!==i.color&&""!=i.color&&r.color.conditions.push(["true","color('"+i.color+"',"+i.opacity+")"]),void 0!==i.highlighted&&i.highlighted.map((function(e){r.color.conditions.unshift(["${id} === '"+e.featureName+"'","color('"+e.color+"',"+e.opacity+")"])})),(void 0!==i.color&&""!=i.color||void 0!==i.highlighted)&&(o.style=new this._etsMap.Cesium3DTileStyle(r)),a.readyPromise.then((function(e){if(void 0!==i.height){let a=i.height,r=e.boundingSphere,s=this._etsMap.Cartographic.fromCartesian(r.center),g=this._etsMap.Cartesian3.fromRadians(s.longitude,s.latitude,0),n=this._etsMap.Cartesian3.fromRadians(s.longitude,s.latitude,a),C=this._etsMap.Cartesian3.subtract(n,g,new this._etsMap.Cartesian3);e.modelMatrix=this._etsMap.Matrix4.fromTranslation(C),t&&t(o)}})),o.featureMap=new Map,o.tileLoad.addEventListener((function(e){!function(e,t){let i=e.content,a=i.innerContents;if(this._etsMap.defined(a))for(let e=a.length-1;e>=0;e--)g(a[e],t);else g(i,t)}(e,s)}));let n=this;return o.setStyle=function(e){let t={color:{conditions:[]}};t.color.conditions=this.style.color.conditionsExpression.conditions;let i=this.style.color.conditionsExpression.conditions;e&&(e.map((function(e){let a=!1;if(i.length>1)for(let o=0;o<i.length;o++)if(-1!=i[o][0].indexOf(e.id)){t.color.conditions[o]=["${id} === '"+e.id+"'","color('"+e.color+"',"+e.opacity+")"],a=!0;break}a||t.color.conditions.unshift(["${id} === '"+e.id+"'","color('"+e.color+"',"+e.opacity+")"])})),o.style=new n._etsMap.Cesium3DTileStyle(t))},o.getStyle=function(){let e=Tools$1.deepCopy(o.style.color.conditionsExpression.conditions);if(e&&o){let t=[];if(e.length>1){for(let i=0;i<e.length-1;i++){let a=e[i][0].replace(/\s+'/g,"").replace("'","").split("===")[1],o=e[i][1].replace("color(","").replace(")","").replace(/\'/g,"").split(",");t.push({id:a,color:o[0],opacity:o[1]})}return t}}},this.TilesModelPrimitives.push(o),o}remove(e){let t=this;if(e){e.split(",").map((function(e){t.TilesModelPrimitives.map((function(i){e==i.id&&(i.destroy(),t.viewer.scene.primitives.remove(i),Tool.delArr(t.TilesModelPrimitives,i))}))}))}else this.TilesModelPrimitives.map((function(e){e.destroy(),t.viewer.scene.primitives.remove(e)})),this.TilesModelPrimitives=[]}hide(e){let t=this;if(e){e.split(",").map((function(e){t.TilesModelPrimitives.map((function(t){e==t.id&&(t.show=!1)}))}))}else this.TilesModelPrimitives.map((function(e){e.show=!1}))}show(e){let t=this;if(e){e.split(",").map((function(e){t.TilesModelPrimitives.map((function(t){e==t.id&&(t.show=!0)}))}))}else this.TilesModelPrimitives.map((function(e){e.show=!0}))}offsetBottom(e){let t=Object.assign({},{height:0},e);this._viewer.scene.primitives._primitives.map((function(e){if(e.id==t.id){let i=e.boundingSphere,a=this._etsMap.Cartographic.fromCartesian(i.center),o=this._etsMap.Cartesian3.fromRadians(a.longitude,a.latitude,0),r=this._etsMap.Cartesian3.fromRadians(a.longitude,a.latitude,Number(t.height)),s=this._etsMap.Cartesian3.subtract(r,o,new this._etsMap.Cartesian3);e.modelMatrix=this._etsMap.Matrix4.fromTranslation(s)}}))}getById(e){let t=null;return e&&this.TilesModelPrimitives.map((function(i){e==i.id&&(t=i)})),t}edit(e,t){let i=Object.assign({},{updateToAttributes:!1},t);if(void 0!==i.height)try{e.readyPromise.then((function(t){let a=e.boundingSphere,o=this._etsMap.Cartographic.fromCartesian(a.center),r=this._etsMap.Cartesian3.fromRadians(o.longitude,o.latitude,0),s=this._etsMap.Cartesian3.fromRadians(o.longitude,o.latitude,Number(i.height)),g=this._etsMap.Cartesian3.subtract(s,r,new this._etsMap.Cartesian3);e.modelMatrix=this._etsMap.Matrix4.fromTranslation(g)}))}catch(e){}if(i.color){let t=Object.assign({},{color:null},i),a={color:{conditions:[]}};""!=typeof t.color&&a.color.conditions.push(["true","color('"+t.color+"',"+t.opacity+")"]),""!=typeof t.color&&e&&(e.style=new this._etsMap.Cesium3DTileStyle(a)),t.updateToAttributes&&(e.attributes.color=t.color)}}changeColor(e){let t=Object.assign({},{updateToAttributes:!1},e);if(t.tileset){let e={color:{conditions:[]}},i=void 0===t.color?t.tileset.attributes.color:t.color,a=void 0===t.opacity?t.tileset.attributes.opacity:t.opacity;e.color.conditions.push(["true","color('"+i+"',"+a+")"]),void 0!==t.highlighted&&(void 0===t.tileset.attributes.highlighted&&t.updateToAttributes&&(t.tileset.attributes.highlighted=t.highlighted),t.highlighted.map((function(t){e.color.conditions.unshift(["${name} === '"+t.featureName+"'","color('"+t.color+"',"+t.opacity+")"])}))),t.tileset.style=new this._etsMap.Cesium3DTileStyle(e)}}changeColorById(e){let t=this,i=t.getById(e.id),a=Object.assign({},{color:i.attributes.color,opacity:i.attributes.opacity},e);i&&t.changeColor({tileset:i,color:a.color,opacity:a.opacity})}onMouseMove(e,t,i){let a=null,o=null,r=null;if(arguments.length<2)return;if(2===arguments.length){if("function"!=typeof arguments[0]||"function"!=typeof arguments[1])return;a=arguments[0],o=arguments[1],r={}}else a=t,o=i,r=e;let s=Object.assign({isEntire:!1,includeElemName:[],excludeElemName:[],selectedColor:"#ff00ff",opacity:1,feature:"name",CIMMAP_STEP:window.CIMMAP_STEP||1},r);this.isEntire=s.isEntire;let g=this._viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let n=null,C=this;function l(e,t,i){e.isEntire&&0==i.includeElemName.length&&0==i.excludeElemName.length?e.changeColor({tileset:n,color:i.selectedColor,opacity:i.opacity}):t.color=e._etsMap.Color.fromAlpha(e._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(i.opacity))}function A(){n&&(n.setStyle(n.getStyle()),n=null,C.opts.originalColorByClick="",C.selected={feature:void 0,originalColor:new C._etsMap.Color},C.highlighted={feature:void 0,originalColor:new C._etsMap.Color})}this.handler.setInputAction((function(e){let t=g.scene.pick(e.endPosition);if(n&&!C._etsMap.defined(C.highlighted.feature))if(C.isEntire&&0==s.includeElemName.length&&0==s.excludeElemName.length)if(void 0===n.attributes.highlighted){let e=n.attributes.color;""!=C.opts.originalColorByClick&&(e=C.opts.selectedColorByClick),""!=C.opts.selectedColorByClick&&C.opts.selectedFeatureByClick.length>0?C.changeColor({tileset:n,color:n.attributes.color,opacity:n.attributes.opacity,highlighted:C.opts.selectedFeatureByClick,updateToAttributes:!0}):C.changeColor({tileset:n,color:e,opacity:n.attributes.opacity})}else C.changeColor({tileset:n,color:n.attributes.color,opacity:n.attributes.opacity,highlighted:n.attributes.highlighted});else void 0===n.attributes.highlighted?C.opts.selectedFeatureByClick.length>0&&n.setStyle(n.getStyle()):void 0!==n.attributes.highlighted&&C.opts.selectedFeatureByClick.length>0||n.setStyle(n.getStyle());if(C._etsMap.defined(C.highlighted.feature)){let e=C.highlighted.originalColor;if(e=C._etsMap.Color.fromCssColorString(C.highlighted.feature.primitive.attributes.color),""!=C.opts.originalColorByClick)C.opts.selectedFeatureByClick.length>0?C.highlighted.feature.getProperty(s.feature)==C.opts.selectedFeatureByClick[0].featureName&&(n.setStyle(n.getStyle()),e=C._etsMap.Color.fromCssColorString(C.opts.selectedColorByClick)):C.opts.isEntireByLeftClick&&(e=C._etsMap.Color.fromCssColorString(C.opts.selectedColorByClick));else{let t=C.highlighted.feature.getProperty(s.feature),i=n.getStyle();i&&i.length>0&&i.map((function(i){i.id==t&&(e=this._etsMap.Color.fromCssColorString(i.color))}))}C.highlighted.feature.color=e,C.highlighted.feature.primitive.color=e,C.highlighted.feature=void 0}if(!C._etsMap.defined(t))return A(),void o(void 0);if(t instanceof C._etsMap.Cesium3DTileFeature)if(C.TilesModelPrimitives.indexOf(t.tileset)>=0){let i=t.getProperty(s.feature);if(n=t._content.tile._content._tileset,-1==C.TilesModelPrimitives.indexOf(n))return void o(void 0);if(s.excludeElemName.length>0){if(-1==s.excludeElemName.indexOf(i)){C.highlighted.feature=t;let o=t.primitive.attributes;return o.featureName=i,l(C,t,s),void a(t.primitive,e,o)}return void o(void 0)}if(s.includeElemName.length>0){if(-1==s.includeElemName.indexOf(i))return void o(void 0);if(t!==C.selected.feature){C.highlighted.feature=t;let o=t.primitive.attributes;o.featureName=i,l(C,t,s),a(t.primitive,e,o)}}else{C.highlighted.feature=t;let o=t.primitive.attributes;o.featureName=i,l(C,t,s),a(t.primitive,e,o)}}else o(void 0);else A()}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)}onClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({isEntire:!1,includeElemName:[],excludeElemName:[],selectedColor:"#ffffff",CIMMAP_STEP:window.CIMMAP_STEP||1,feature:"name"},a),r=this._viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let s=null,g=this;function n(e,t,i){let a=i.opacity?i.opacity:t.primitive.attributes.opacity;e._etsMap.Color.clone(t.color,e.highlighted.originalColor),t.color=e._etsMap.Color.fromAlpha(e._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(a))}this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(g.opts.selectedColorByClick="",g._etsMap.defined(g.highlighted.feature)&&o.selectedColor&&(g.highlighted.feature.color=g.highlighted.originalColor,g.highlighted.feature.primitive.color=g.highlighted.originalColor,g.highlighted.feature=void 0),s&&(g._etsMap.defined(t)&&-1!=g.TilesModelPrimitives.indexOf(t.tileset)?void 0!==s.attributes.highlighted&&g.changeColor({tileset:s,color:s.attributes.color,opacity:s.attributes.opacity,highlighted:s.attributes.highlighted}):(g.opts.originalColorByClick="",o.isEntire?void 0!==s.attributes.highlighted?g.changeColor({tileset:s,color:s.attributes.color,opacity:s.attributes.opacity,highlighted:s.attributes.highlighted}):g.changeColor({tileset:s,color:s.attributes.color,opacity:s.attributes.opacity}):(s.attributes.highlighted=void 0,g.opts.selectedFeatureByClick=[],s.setStyle(s.getStyle())))),g._etsMap.defined(t)&&t instanceof g._etsMap.Cesium3DTileFeature){let a=t.getProperty(o.feature);if(g.TilesModelPrimitives.indexOf(t.tileset)>=0){if(s=t.tileset,g.opts.selectedColorByClick=o.selectedColor,o.isEntire&&0==o.includeElemName.length&&0==o.excludeElemName.length?(g.opts.isEntireByLeftClick=o.isEntire,void 0!==s.attributes.highlighted?g.changeColor({tileset:s,color:o.selectedColor,opacity:s.attributes.opacity}):(g.changeColor({tileset:s,color:o.selectedColor,opacity:s.attributes.opacity}),g.opts.originalColorByClick=o.selectedColor)):(g.opts.originalColorByClick=o.selectedColor,g.opts.selectedFeatureByClick=[{featureName:a,color:o.selectedColor,opacity:1}]),s=t._content.tile._content._tileset,-1==g.TilesModelPrimitives.indexOf(s))return;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a)){g.highlighted.feature=t;let r=t.primitive.attributes;return r.featureName=a,n(g,t,o),void i(t.primitive,e,r)}}else{if(!(o.includeElemName.length>0)){g.highlighted.feature=t,t.primitive.attributes.highlighted=void 0;let r=t.primitive.attributes;return r.featureName=a,r.properties=t.content.batchTable._properties,n(g,t,o),void i(t.primitive,e,r)}if(-1==o.includeElemName.indexOf(a))return;if(t!==g.selected.feature){g.highlighted.feature=t;let r=t.primitive.attributes;return r.featureName=a,n(g,t,o),void i(t.primitive,e,r)}}}}}),g._etsMap.ScreenSpaceEventType.LEFT_CLICK)}onRightClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({isEntire:!1,includeElemName:[],excludeElemName:[],selectedColor:"#ffffff",CIMMAP_STEP:window.CIMMAP_STEP||1,feature:"name"},a),r=this._viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let s=null,g=this;function n(e,t,i){let a=i.opacity?i.opacity:t.primitive.attributes.opacity;this._etsMap.Color.clone(t.color,e.highlighted.originalColor),t.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(a))}this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(o.isEntire&&s&&(void 0===s.attributes.highlighted?g.changeColor({tileset:s,color:s.attributes.color,opacity:s.attributes.opacity}):g.changeColor({tileset:s,color:s.attributes.color,opacity:s.attributes.opacity,highlighted:s.attributes.highlighted})),this._etsMap.defined(g.highlighted.feature)&&o.selectedColor&&(g.highlighted.feature.color=g.highlighted.originalColor,g.highlighted.feature.primitive.color=g.highlighted.originalColor,g.highlighted.feature=void 0),this._etsMap.defined(t)&&t instanceof this._etsMap.Cesium3DTileFeature){let a=t.getProperty(o.feature);if(s=t._content.tile._content._tileset,-1==g.TilesModelPrimitives.indexOf(s))return;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a)){g.highlighted.feature=t;let r=t.primitive.attributes;return r.featureName=a,n(g,t,o),void i(t.primitive,e,r)}}else{if(!(o.includeElemName.length>0)){g.highlighted.feature=t;let r=t.primitive.attributes;return r.featureName=a,n(g,t,o),void i(t.primitive,e,r)}if(-1==o.includeElemName.indexOf(a))return;if(t!==g.selected.feature){g.highlighted.feature=t;let r=t.primitive.attributes;return r.featureName=a,n(g,t,o),void i(t.primitive,e,r)}}}}),this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}getTileTree(param){let options=Object.assign({},{url:"",filterKey:"",data:[],concatId:"",tileTreeData:[],private:!1},param),index=options.url.lastIndexOf("/"),url=options.url.substr(0,index)+"/scenetree.json",self=this;return Tool.get(url,(function(res){let data=eval("("+res+")"),result=data.scenes[0].children;options.tileTreeData=result,self.tileTreeData=result,result.map((function(e){if(0==e.id.indexOf(options.filterKey)){let t=Tool.cartesianToCartographic(this._etsMap,self.viewer,e.sphere[0],e.sphere[1],e.sphere[2]);options.data.push({id:options.concatId+e.id,longitude:t[0],latitude:t[1],height:t[2]})}}))})),options.private?options.tileTreeData:options.data}trackByTileId(e){let t=Object.assign({id:"",duration:.5,deviationValue:5},e),i=this;t.id&&this.tileTreeData.map((function(e){if(t.id==e.id){let a=e.sphere;if(a[3]<=0)return;let o=new this._etsMap.Cartesian3(a[0],a[1],a[2]),r=new this._etsMap.BoundingSphere(o,a[3]+t.deviationValue);i.viewer.camera.flyToBoundingSphere(r,{duration:t.duration})}}))}unbindEvent(e){switch(e){case"LEFT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}}}class SingleModelLayer{opts={longitude:120.3735451984391,latitude:36.081137879527624,color:"",opacity:1,selectedColor:"#00fb29",key:"",scale:1,show:!0,attr:{}};constructor(e){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas),this.SingleModelPrimitives=[],this.layerId=e}loadModel(e){let t=Object.assign({},this.opts,{height:0},e);void 0!==t.colorAlpha&&(t.opacity=t.colorAlpha);let i=this._etsMap.Model.fromGltf({url:t.url,modelMatrix:this._etsMap.Transforms.eastNorthUpToFixedFrame(this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height)),colorBlendMode:0,silhouetteSize:0,minimumPixelSize:0,readonlyallowPicking:!0,colorBlendAmountEnabled:!0,extrudedHeight:1e5,colorBlendAmount:parseFloat(1),show:t.show,scale:t.scale,dynamicScreenSpaceError:!0,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:4,dynamicScreenSpaceErrorHeightFalloff:.25,skipLevelOfDetail:!0});if(t.color){let e=1;e=t.opacity?t.opacity:i.color.alpha,i.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(e))}return console.log(i.color),i.pos=[t.longitude,t.latitude],i.type="single",i.id=t.id,i.attributes=t,i.key=t.key,i.layerId=this.layerId,this._viewer.scene.primitives.add(i),this.SingleModelPrimitives.push(i),i}remove(e){let t=this;if(e){e.split(",").map((function(e){t.SingleModelPrimitives.map((function(i){e==i.id&&(t.viewer.scene.primitives.remove(i),Tools$1.delArr(t.SingleModelPrimitives,i))}))}))}else this.SingleModelPrimitives.map((function(e){t.viewer.scene.primitives.remove(e)})),this.SingleModelPrimitives=[]}hide(e){let t=this;if(e){e.split(",").map((function(e){t.SingleModelPrimitives.map((function(t){e==t.id&&(t.show=!1)}))}))}else this.SingleModelPrimitives.map((function(e){e.show=!1}))}show(e){let t=this;if(e){e.split(",").map((function(e){t.SingleModelPrimitives.map((function(t){e==t.id&&(t.show=!0)}))}))}else this.SingleModelPrimitives.map((function(e){e.show=!0}))}getById(e){let t=null;return e&&this.SingleModelPrimitives.map((function(i){e==i.id&&(t=i)})),t}changeColor(e){let t=Object.assign({},{single:null,color:""},e);if(t.single){if(!t.color&&!t.opacity)return;let i=void 0===e.opacity?t.object.attributes.opacity:t.opacity,a=t.color?t.color:Tools$1.originalColorTo16(t.object.color).color;t.object.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(a),parseFloat(i)),t.object.attributes.opacity=t.opacity,t.object.attributes.color=t.color}}changeColorById(e){let t=this,i=Object.assign({},{id:"",color:""},e),a=t.getById(i.id);a&&(i.object=a,t.changeColor(i))}edit(e,t){let i=e;i.attributes=Object.assign({},i.attributes,t),t.color&&(!t.opacity||t.opacity,i.attributes.opacity,i.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.opacity))),t.scale&&(i.scale=t.scale),void 0!==t.height&&(i.modelMatrix=this._etsMap.Transforms.eastNorthUpToFixedFrame(this._etsMap.Cartesian3.fromDegrees(i.attributes.longitude,i.attributes.latitude,t.height))),t.shadows&&(i.shadows=t.shadows),void 0!==t.longitude&&void 0!==t.latitude&&(i.modelMatrix=this._etsMap.Transforms.eastNorthUpToFixedFrame(this._etsMap.Cartesian3.fromDegrees(t.longitude,t.latitude,i.attributes.height)))}onMouseMove(e,t,i){let a=null,o=null,r=null;if(arguments.length<2)return;if(2===arguments.length){if("function"!=typeof arguments[0]||"function"!=typeof arguments[1])return;a=arguments[0],o=arguments[1],r={}}else a=t,o=i,r=e;let s=Object.assign({includeElemName:[],excludeElemName:[],selectedColor:"#ffffff",opacity:1,CIMMAP_STEP:window.CIMMAP_STEP||1},r),g=this.viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let n=this;function C(e,t,i){this._etsMap.Color.clone(t.primitive.color,e.highlighted.originalColor),t.primitive.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(i.opacity))}this.handler.setInputAction((function(e){let t=g.scene.pick(e.endPosition);if(this._etsMap.defined(n.highlighted.feature)&&(n.highlighted.feature.color=n.highlighted.originalColor,n.highlighted.feature.primitive.color=n.highlighted.originalColor,n.highlighted.feature=void 0),this._etsMap.defined(t)){if("single"==t.primitive.type){if(-1==n.SingleModelPrimitives.indexOf(t.primitive))return;let i=t.primitive.id;if(s.excludeElemName.length>0){if(-1==s.excludeElemName.indexOf(i)){n.highlighted.feature=t;let i=t.primitive.attributes;return C(n,t,s),void a(t.primitive,e,i)}return void o(void 0)}if(!(s.includeElemName.length>0)){n.highlighted.feature=t;let i=t.primitive.attributes;return C(n,t,s),void a(t.primitive,e,i)}if(-1==s.includeElemName.indexOf(i))return void o(void 0);if(t!==n.selected.feature){n.highlighted.feature=t;let i=t.primitive.attributes;return C(n,t,s),void a(t.primitive,e,i)}}}else o(void 0)}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)}onClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({includeElemName:[],excludeElemName:[],selectedColor:"#ffffff",CIMMAP_STEP:window.CIMMAP_STEP||1},a),r=this.viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let s=this;function g(e,t,i){let a=i.opacity?i.opacity:t.primitive.attributes.opacity;this._etsMap.Color.clone(t.primitive.color,e.highlighted.originalColor),t.primitive.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(a))}this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(this._etsMap.defined(s.highlighted.feature)&&(s.highlighted.feature.color=s.highlighted.originalColor,s.highlighted.feature.primitive.color=s.highlighted.originalColor,s.highlighted.feature=void 0),this._etsMap.defined(t)&&"single"==t.primitive.type){if(-1==s.SingleModelPrimitives.indexOf(t.primitive))return;let a=t.primitive.id;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a)){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}}else{if(!(o.includeElemName.length>0)){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}if(-1!==o.includeElemName.indexOf(a)&&t!==s.selected.feature){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}}}}),this._etsMap.ScreenSpaceEventType.LEFT_CLICK)}onRightClick(e,t){let i=null,a=null;switch(arguments.length){case 0:return;case 1:if("function"!=typeof arguments[0])return;i=arguments[0],a={};break;default:i=t,a=e}let o=Object.assign({includeElemName:[],excludeElemName:[],selectedColor:"#ffffff",CIMMAP_STEP:window.CIMMAP_STEP||1},a),r=this.viewer;this.selected={feature:void 0,originalColor:new this._etsMap.Color},this.highlighted={feature:void 0,originalColor:new this._etsMap.Color};let s=this;function g(e,t,i){let a=i.opacity?i.opacity:t.primitive.attributes.opacity;this._etsMap.Color.clone(t.primitive.color,e.highlighted.originalColor),t.primitive.color=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(i.selectedColor),parseFloat(a))}this.handler.setInputAction((function(e){let t=r.scene.pick(e.position);if(this._etsMap.defined(s.highlighted.feature)&&(s.highlighted.feature.color=s.highlighted.originalColor,s.highlighted.feature.primitive.color=s.highlighted.originalColor,s.highlighted.feature=void 0),this._etsMap.defined(t)&&"single"==t.primitive.type){if(-1==s.SingleModelPrimitives.indexOf(t.primitive))return;let a=t.primitive.id;if(o.excludeElemName.length>0){if(-1==o.excludeElemName.indexOf(a)){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}}else{if(!(o.includeElemName.length>0)){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}if(-1!==o.includeElemName.indexOf(a)&&t!==s.selected.feature){s.highlighted.feature=t;let a=t.primitive.attributes;return g(s,t,o),void i(t.primitive,e,a)}}}}),this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}unbindEvent(e){switch(e){case"LEFT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":this.handler.removeInputAction(this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}}onDrag(e){let t,i,a,o;new this._etsMap.Color,new this._etsMap.Color;let r=this;this._viewer.screenSpaceEventHandler.setInputAction((function(e){if(t=r._viewer.scene.pick(e.position),i=!0,t){if("pointIcon"!==t.id.name){let i=e.position,r=t.primitive.pos,s=Tools$1.wgs84ToWindowCoordinates(etsMap.getApi(),etsMap.getViewer(),r[0],r[1]);a=i.x-s.x,o=i.y-s.y}r._viewer.scene.screenSpaceCameraController.enableRotate=!1}}),this._etsMap.ScreenSpaceEventType.LEFT_DOWN),r._viewer.screenSpaceEventHandler.setInputAction((function(a){e(t),i=!1,t=null,r._viewer.scene.screenSpaceCameraController.enableRotate=!0}),this._etsMap.ScreenSpaceEventType.LEFT_UP),r._viewer.screenSpaceEventHandler.setInputAction((function(e){if(!0===i&&null!=t){let i;if("string"==typeof t.primitive.id){let s=t.primitive.pos,g=Tools$1.wgs84ToWindowCoordinates(etsMap.getApi(),etsMap.getViewer(),s[0],s[1]),n=e.endPosition;g.x=n.x-a,g.y=n.y-o,i=r._viewer.camera.getPickRay(g)}"pointIcon"==t.id.name&&(i=r._viewer.camera.getPickRay(e.endPosition));let s=r._viewer.scene.globe.pick(i,r._viewer.scene);if(s)if("string"!=typeof t.primitive.id)t.primitive.id.position._value=s;else{let e=Tools$1.cartesianToCartographic(etsMap.getApi(),etsMap.getViewer(),s.x,s.y,s.z);t.primitive.modelMatrix=r._etsMap.Transforms.eastNorthUpToFixedFrame(r._etsMap.Cartesian3.fromDegrees(e[0],e[1],e[2])),t.primitive.pos[0]=e[0],t.primitive.pos[1]=e[1]}}}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)}}var HeatmapConfig,Store,Canvas2dRenderer,Renderer,Util,Heatmap,rendererFn;window.h337=(HeatmapConfig={defaultRadius:10,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},Store=function(){var e=function(e){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)},t=HeatmapConfig.defaultRadius;return e.prototype={_organiseData:function(e,i){var a=e[this._xField],o=e[this._yField],r=this._radi,s=this._data,g=this._max,n=this._min,C=e[this._valueField]||1,l=e.radius||this._cfgRadius||t;s[a]||(s[a]=[],r[a]=[]),s[a][o]?s[a][o]+=C:(s[a][o]=C,r[a][o]=l);var A=s[a][o];return A>g?(i?this.setDataMax(A):this._max=A,!1):A<n?(i?this.setDataMin(A):this._min=A,!1):{x:a,y:o,value:C,radius:l,min:n,max:g}},_unOrganizeData:function(){var e=[],t=this._data,i=this._radi;for(var a in t)for(var o in t[a])e.push({x:a,y:o,radius:i[a][o],value:t[a][o]});return{min:this._min,max:this._max,data:e}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var e=arguments[0],t=e.length;t--;)this.addData.call(this,e[t]);else{var i=this._organiseData(arguments[0],!0);i&&(0===this._data.length&&(this._min=this._max=i.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]}))}return this},setData:function(e){var t=e.data,i=t.length;this._data=[],this._radi=[];for(var a=0;a<i;a++)this._organiseData(t[a],!1);return this._max=e.max,this._min=e.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(e){return this._max=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(e){return this._min=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(e){this._coordinator=e},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e}(),Canvas2dRenderer=function(){var e=function(e){var t=e.gradient||e.defaultGradient,i=document.createElement("canvas"),a=i.getContext("2d");i.width=256,i.height=1;var o=a.createLinearGradient(0,0,256,1);for(var r in t)o.addColorStop(r,t[r]);return a.fillStyle=o,a.fillRect(0,0,256,1),a.getImageData(0,0,256,1).data},t=function(e,t){var i=document.createElement("canvas"),a=i.getContext("2d"),o=e,r=e;if(i.width=i.height=2*e,1==t)a.beginPath(),a.arc(o,r,e,0,2*Math.PI,!1),a.fillStyle="rgba(0,0,0,1)",a.fill();else{var s=a.createRadialGradient(o,r,e*t,o,r,e);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=s,a.fillRect(0,0,2*e,2*e)}return i},i=function(e){for(var t=[],i=e.min,a=e.max,o=e.radi,r=(e=e.data,Object.keys(e)),s=r.length;s--;)for(var g=r[s],n=Object.keys(e[g]),C=n.length;C--;){var l=n[C],A=e[g][l],I=o[g][l];t.push({x:g,y:l,value:A,radius:I})}return{min:i,max:a,data:t}};function a(t){var i=t.container,a=this.shadowCanvas=document.createElement("canvas"),o=this.canvas=t.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var r=getComputedStyle(t.container)||{};o.className="heatmap-canvas",this._width=o.width=a.width=t.width||+r.width.replace(/px/,""),this._height=o.height=a.height=t.height||+r.height.replace(/px/,""),this.shadowCtx=a.getContext("2d"),this.ctx=o.getContext("2d"),o.style.cssText=a.style.cssText="position:absolute;left:0;top:0;",i.style.position="relative",i.appendChild(o),this._palette=e(t),this._templates={},this._setStyles(t)}return a.prototype={renderPartial:function(e){e.data.length>0&&(this._drawAlpha(e),this._colorize())},renderAll:function(e){this._clear(),e.data.length>0&&(this._drawAlpha(i(e)),this._colorize())},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(e){e.gradient&&this._updateGradient(e),this._setStyles(e)},setDimensions:function(e,t){this._width=e,this._height=t,this.canvas.width=this.shadowCanvas.width=e,this.canvas.height=this.shadowCanvas.height=t},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(e){this._blur=0==e.blur?0:e.blur||e.defaultBlur,e.backgroundColor&&(this.canvas.style.backgroundColor=e.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=e.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=e.height||this._height,this._opacity=255*(e.opacity||0),this._maxOpacity=255*(e.maxOpacity||e.defaultMaxOpacity),this._minOpacity=255*(e.minOpacity||e.defaultMinOpacity),this._useGradientOpacity=!!e.useGradientOpacity},_drawAlpha:function(e){for(var i=this._min=e.min,a=this._max=e.max,o=(e=e.data||[]).length,r=1-this._blur;o--;){var s,g=e[o],n=g.x,C=g.y,l=g.radius,A=Math.min(g.value,a),I=n-l,h=C-l,c=this.shadowCtx;this._templates[l]?s=this._templates[l]:this._templates[l]=s=t(l,r);var p=(A-i)/(a-i);c.globalAlpha=p<.01?.01:p,c.drawImage(s,I,h),I<this._renderBoundaries[0]&&(this._renderBoundaries[0]=I),h<this._renderBoundaries[1]&&(this._renderBoundaries[1]=h),I+2*l>this._renderBoundaries[2]&&(this._renderBoundaries[2]=I+2*l),h+2*l>this._renderBoundaries[3]&&(this._renderBoundaries[3]=h+2*l)}},_colorize:function(){var e=this._renderBoundaries[0],t=this._renderBoundaries[1],i=this._renderBoundaries[2]-e,a=this._renderBoundaries[3]-t,o=this._width,r=this._height,s=this._opacity,g=this._maxOpacity,n=this._minOpacity,C=this._useGradientOpacity;e<0&&(e=0),t<0&&(t=0),e+i>o&&(i=o-e),t+a>r&&(a=r-t);for(var l=this.shadowCtx.getImageData(e,t,i,a),A=l.data,I=A.length,h=this._palette,c=3;c<I;c+=4){var p,d=A[c],u=4*d;u&&(p=s>0?s:d<g?d<n?n:d:g,A[c-3]=h[u],A[c-2]=h[u+1],A[c-1]=h[u+2],A[c]=C?h[u+3]:p)}this.ctx.putImageData(l,e,t),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(e){var t=this.shadowCtx.getImageData(e.x,e.y,1,1).data[3],i=this._max,a=this._min;return Math.abs(i-a)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},a}(),rendererFn=!1,"canvas2d"===HeatmapConfig.defaultRenderer&&(rendererFn=Canvas2dRenderer),Renderer=rendererFn,Util={merge:function(){for(var e={},t=arguments.length,i=0;i<t;i++){var a=arguments[i];for(var o in a)e[o]=a[o]}return e}},Heatmap=function(){var e=function(){function e(){this.cStore={}}return e.prototype={on:function(e,t,i){var a=this.cStore;a[e]||(a[e]=[]),a[e].push((function(e){return t.call(i,e)}))},emit:function(e,t){var i=this.cStore;if(i[e])for(var a=i[e].length,o=0;o<a;o++)(0,i[e][o])(t)}},e}(),t=function(e){var t=e._renderer,i=e._coordinator,a=e._store;i.on("renderpartial",t.renderPartial,t),i.on("renderall",t.renderAll,t),i.on("extremachange",(function(t){e._config.onExtremaChange&&e._config.onExtremaChange({min:t.min,max:t.max,gradient:e._config.gradient||e._config.defaultGradient})})),a.setCoordinator(i)};function i(){var i=this._config=Util.merge(HeatmapConfig,arguments[0]||{});if(this._coordinator=new e,i.plugin){var a=i.plugin;if(!HeatmapConfig.plugins[a])throw new Error("Plugin '"+a+"' not found. Maybe it was not registered.");var o=HeatmapConfig.plugins[a];this._renderer=new o.renderer(i),this._store=new o.store(i)}else this._renderer=new Renderer(i),this._store=new Store(i);t(this)}return i.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=Util.merge(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},i}(),{create:function(e){return new Heatmap(e)},register:function(e,t){HeatmapConfig.plugins[e]=t}});class EtsMapHeatMap{defaults={useEntitiesIfAvailable:!0,minCanvasSize:700,maxCanvasSize:2e3,radiusFactor:60,spacingFactor:1.5,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{".3":"blue",".65":"yellow",".8":"orange",".90":"red"}};constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this._WMP=new this._etsMap.WebMercatorProjection}create=function(e,t){return new CHInstance(this,this._etsMap,this._viewer,e,t,h337)};_getContainer=function(e,t,i){var a=document.createElement("div");return i&&a.setAttribute("id",i),a.setAttribute("style","width: "+e+"px; height: "+t+"px; margin: 0px; display: none;"),document.body.appendChild(a),a};_getImageryProvider=function(e){var t=e._heatmap.getDataURL(),i=new this._etsMap.SingleTileImageryProvider({url:t,rectangle:e._rectangle});return i._tilingScheme=new this._etsMap.WebMercatorTilingScheme({rectangleSouthwestInMeters:new this._etsMap.Cartesian2(e._mbounds.west,e._mbounds.south),rectangleNortheastInMeters:new this._etsMap.Cartesian2(e._mbounds.east,e._mbounds.north)}),i};_getID=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<(e||8);a++)t+=i.charAt(Math.floor(Math.random()*i.length));return t};wgs84ToMercator=function(e){var t=this._WMP.project(this._etsMap.Cartographic.fromDegrees(e.x,e.y));return{x:t.x,y:t.y}};wgs84ToMercatorBB=function(e){var t=this._WMP.project(this._etsMap.Cartographic.fromDegrees(e.west,e.south)),i=this._WMP.project(this._etsMap.Cartographic.fromDegrees(e.east,e.north));return{north:i.y,east:i.x,south:t.y,west:t.x}};mercatorToWgs84=function(e){var t=this._WMP.unproject(new this._etsMap.Cartesian3(e.x,e.y));return{x:t.longitude,y:t.latitude}};mercatorToWgs84BB=function(e){var t=this._WMP.unproject(new this._etsMap.Cartesian3(e.west,e.south)),i=this._WMP.unproject(new this._etsMap.Cartesian3(e.east,e.north));return{north:this.rad2deg(i.latitude),east:this.rad2deg(i.longitude),south:this.rad2deg(t.latitude),west:this.rad2deg(t.longitude)}};deg2rad=function(e){return e*(Math.PI/180)};rad2deg=function(e){return e/(Math.PI/180)}}function CHInstance(e,t,i,a,o,r){if(this._cimMapHeatmap=e,!a)return null;o||(o={}),this._viewer=i,this._cesium=t,this._options=o,this._id=this._cimMapHeatmap._getID(),this._options.gradient=this._options.gradient?this._options.gradient:this._cimMapHeatmap.defaults.gradient,this._options.maxOpacity=this._options.maxOpacity?this._options.maxOpacity:this._cimMapHeatmap.defaults.maxOpacity,this._options.minOpacity=this._options.minOpacity?this._options.minOpacity:this._cimMapHeatmap.defaults.minOpacity,this._options.blur=this._options.blur?this._options.blur:this._cimMapHeatmap.defaults.blur,this._mbounds=this._cimMapHeatmap.wgs84ToMercatorBB(a),this._setWidthAndHeight(this._mbounds),this._options.radius=Math.round(this._options.radius?this._options.radius:this.width>this.height?this.width/this._cimMapHeatmap.defaults.radiusFactor:this.height/this._cimMapHeatmap.defaults.radiusFactor),this._spacing=this._options.radius*this._cimMapHeatmap.defaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this._cimMapHeatmap.mercatorToWgs84BB(this._mbounds),this._rectangle=this._cesium.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north),this._container=this._cimMapHeatmap._getContainer(this.width,this.height,this._id),this._options.container=this._container,this._heatmap=r.create(this._options),this._container.children[0].setAttribute("id",this._id+"-hm")}CHInstance.prototype.wgs84PointToHeatmapPoint=function(e){return this.mercatorPointToHeatmapPoint(this._cimMapHeatmap.wgs84ToMercator(e))},CHInstance.prototype.mercatorPointToHeatmapPoint=function(e){var t={};return t.x=Math.round((e.x-this._xoffset)/this._factor+this._spacing),t.y=Math.round((e.y-this._yoffset)/this._factor+this._spacing),t.y=this.height-t.y,t},CHInstance.prototype._setWidthAndHeight=function(e){this.width=e.east>0&&e.west<0?e.east+Math.abs(e.west):Math.abs(e.east-e.west),this.height=e.north>0&&e.south<0?e.north+Math.abs(e.south):Math.abs(e.north-e.south),this._factor=1,this.width>this.height&&this.width>this._cimMapHeatmap.defaults.maxCanvasSize?(this._factor=this.width/this._cimMapHeatmap.defaults.maxCanvasSize,this.height/this._factor<this._cimMapHeatmap.defaults.minCanvasSize&&(this._factor=this.height/this._cimMapHeatmap.defaults.minCanvasSize)):this.height>this.width&&this.height>this._cimMapHeatmap.defaults.maxCanvasSize?(this._factor=this.height/this._cimMapHeatmap.defaults.maxCanvasSize,this.width/this._factor<this._cimMapHeatmap.defaults.minCanvasSize&&(this._factor=this.width/this._cimMapHeatmap.defaults.minCanvasSize)):this.width<this.height&&this.width<this._cimMapHeatmap.defaults.minCanvasSize?(this._factor=this.width/this._cimMapHeatmap.defaults.minCanvasSize,this.height/this._factor>this._cimMapHeatmap.defaults.maxCanvasSize&&(this._factor=this.height/this._cimMapHeatmap.defaults.maxCanvasSize)):this.height<this.width&&this.height<this._cimMapHeatmap.defaults.minCanvasSize&&(this._factor=this.height/this._cimMapHeatmap.defaults.minCanvasSize,this.width/this._factor>this._cimMapHeatmap.defaults.maxCanvasSize&&(this._factor=this.width/this._cimMapHeatmap.defaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},CHInstance.prototype.setData=function(e,t,i){return!!(i&&i.length>0&&null!==e&&!1!==e&&null!==t&&!1!==t)&&(this._heatmap.setData({min:e,max:t,data:i}),this.updateLayer(),!0)},CHInstance.prototype.setWGS84Data=function(e,t,i){if(i&&i.length>0&&null!==e&&!1!==e&&null!==t&&!1!==t){for(var a=[],o=0;o<i.length;o++){var r=i[o],s=this.wgs84PointToHeatmapPoint(r);(r.value||0===r.value)&&(s.value=r.value),a.push(s)}return this.setData(e,t,a)}return!1},CHInstance.prototype.show=function(e,t){this._layer&&(this._layer.show=e,arguments.length>0&&t&&(this._layer.id=t))},CHInstance.prototype.updateLayer=function(){if(this._cimMapHeatmap.defaults.useEntitiesIfAvailable&&this._cesium.entities)this._layer&&this._cesium.entities.remove(this._layer),this._layer=this._cesium.entities.add({show:!0,rectangle:{coordinates:this._rectangle,material:this._heatmap._renderer.canvas}});else{this._layer&&this._viewer.scene.imageryLayers.remove(this._layer);var e=this._cimMapHeatmap._getImageryProvider(this);this._layer=this._viewer.scene.imageryLayers.addImageryProvider(e)}};class EtsHeatMap{defaults={boundingBox:{north:36.12186258807239,west:120.33611598596401,south:36.06105434748193,east:120.39057681590221},options:{radius:50,blur:.9,backgroundColor:"rgba(0, 0, 58, 0.96)",latField:"x",lngField:"y",valueField:"value",maxOpacity:.8,gradient:{".3":"green",".65":"yellow",".8":"orange",".90":"red"},scaleRadius:!0}};constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.instance=null}init(e){this._etsMap,this._viewer;let t=Object.assign({},this.defaults,e);t.id&&(this.id=t.id);let i=new EtsMapHeatMap;this.instance=i.create(t.boundingBox,t.options),this.instance.setWGS84Data(t.heatData.min,t.heatData.max,t.heatData.data),this.show()}show(){this.instance.show(!0,this.id)}hide(){this.instance.show(!1)}remove(e){if(!e)return;let t=this._viewer.imageryLayers;t._layers.map((function(i){void 0!==i&&void 0!==i.id&&e==i.id&&t.remove(i)}))}}class Measure{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer(),this.poly=null,this.shapeEntity=null,this.measureEntities=null,this.measureEntities=this._viewer.entities.add(new this._etsMap.Entity)}opts={width:2,colorAlpha:1,color:"#ffffff",outline:!0,outlineWidth:1,outlineColor:"#fe0000",fill:!0,fillColor:"#febf00",fillColorAlpha:.5,height:1,url:"",scale:1,movedScale:1.1,activeShapePoints:[],activeShape:null,floatingPoint:null,shapeData:{line:[],polygon:[]},isEndDraw:!1,shapeType:"line",attributes:{},lineDistance:0,shapes:[],tempPoints:[],verticalDistance:0,positions:[],CIMMAP_STEP:window.CIMMAP_STEP||1};getHeight(e){if(e[0]&&e[1]){let t=this._etsMap.Cartographic.fromCartesian(e[0]);return(this._etsMap.Cartographic.fromCartesian(e[1]).height-t.height).toFixed(2)}}distance(e,t){let i=this._etsMap.Cartographic.fromCartesian(e),a=this._etsMap.Cartographic.fromCartesian(t),o=new this._etsMap.EllipsoidGeodesic;o.setEndPoints(i,a);let r=o.surfaceDistance;return r=Math.sqrt(Math.pow(r,2)+Math.pow(a.height-i.height,2)),r}getSpaceDistance(e){let t=0;for(var i=0;i<e.length-1;i++){t+=this.distance(e[i],e[i+1])}return t.toFixed(2)}getArea(e,t){let i=0;for(var a=0;a<e.length-2;a++){let o=(a+1)%e.length,r=(a+2)%e.length,s=Tools$1.angle(e[a],e[o],e[r]);i+=this.distance(t[a],t[o])*this.distance(t[o],t[r])*Math.abs(Math.sin(s))}return(i/1e6).toFixed(4)}createPoint(e,t){let i=this.opts;this._viewer;let a=t||"";"line"==i.shapeType&&(a=this.opts.lineDistance+"\u7c73");let o={parent:this.measureEntities,position:e,name:"drawPoint",type:"measurePoint",point:{scale:this.opts.CIMMAP_STEP,color:this._etsMap.Color.RED,pixelSize:5*this.opts.CIMMAP_STEP,outlineColor:this._etsMap.Color.WHITE,outlineWidth:2*this.opts.CIMMAP_STEP,heightReference:this._etsMap.HeightReference.CLAMP_TO_GROUND}};return a&&(o.label={scale:this.opts.CIMMAP_STEP,text:a,font:"18px sans-serif",fillColor:this._etsMap.Color.RED,style:this._etsMap.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:this._etsMap.VerticalOrigin.BOTTOM,pixelOffset:new this._etsMap.Cartesian2(20,-20)}),this._viewer.entities.add(o)}createLabel(e,t){return this._viewer.entities.add({parent:this.measureEntities,position:e,name:"precinctPoint",type:"precinct",label:{text:t,font:"10pt Helvetica",scale:this.opts.CIMMAP_STEP,style:this._etsMap.LabelStyle.FILL,fillColor:this._etsMap.Color.fromCssColorString("#FF0000"),verticalOrigin:this._etsMap.VerticalOrigin.CENTER,horizontalOrigin:this._etsMap.HorizontalOrigin.LEFT,pixelOffset:new this._etsMap.Cartesian2(10,0),color:this._etsMap.Color.RED,pixelSize:5,heightReference:this._etsMap.HeightReference.CLAMP_TO_GROUND}})}shape(e){let t=this.opts;switch(t.shapeType){case"line":t.attributes.position=t.shapeData.line;let i=this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.color),parseFloat(t.colorAlpha)),a=new this._etsMap.PolylineOutlineMaterialProperty({color:i,outline:t.outline,outlineWidth:t.outlineWidth,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor)}),o={parent:this.measureEntities,name:"drawLine",type:"measureShape",attributes:t.attributes,polyline:{positions:e,clampToGround:!0,width:t.width*this.opts.CIMMAP_STEP,material:a}};this.shapeEntity=this._viewer.entities.add(o);break;case"polygon":t.attributes.position=t.shapeData.polygon;let r={parent:this.measureEntities,name:"drawPolygon",type:"measureShape",attributes:t.attributes,polygon:{hierarchy:e,material:this._etsMap.Color.fromAlpha(this._etsMap.Color.fromCssColorString(t.fillColor),parseFloat(t.fillColorAlpha)),outline:t.outline,outlineWidth:t.outlineWidth,outlineColor:this._etsMap.Color.fromCssColorString(t.outlineColor)}};this.shapeEntity=this._viewer.entities.add(r)}return t.shapes.push(this.shapeEntity),this.shapeEntity}terminateShape(){let e=this.opts;e.isEndDraw=!1,this._viewer.entities.remove(e.floatingPoint),this._viewer.entities.remove(e.activeShape),e.floatingPoint=void 0,e.activeShape=void 0,e.activeShapePoints=[],e.shapeData.polygon=[],e.shapeData.line=[],e.lineDistance=0,e.tempPoints=[],e.verticalDistance=0,e.positions=[],e.poly=null,this.end()}remove(){let e=this._viewer;this.opts.shapes.map((function(t){"measureShape"!=t.type&&"measurePoint"!=t.type||e.entities.removeById(t.id)})),this.measureEntities._children.map((function(t){e.entities.remove(t)})),e.entities.remove(this.measureEntities),this.opts.shapes=[]}pickPosition_bak(){new Cesium.ScreenSpaceEventHandler(scene.canvas).setInputAction((function(e){var t=viewer.camera.getPickRay(e.position),i=viewer.scene.globe.pick(t,viewer.scene),a=Cesium.Cartographic.fromCartesian(i);Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude);a.height}),Cesium.ScreenSpaceEventType.LEFT_CLICK),\u65b9\u6cd5\u4e8c,new Cesium.ScreenSpaceEventHandler(scene.canvas).setInputAction((function(e){var t=viewer.camera.getPickRay(e.position),i=viewer.scene.globe.pick(t,viewer.scene),a=Cesium.Cartographic.fromCartesian(i);Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude);viewer.scene.globe.getHeight(a).height}),Cesium.ScreenSpaceEventType.LEFT_CLICK),new Cesium.ScreenSpaceEventHandler(scene.canvas).setInputAction((function(e){var t=viewer.scene;if(t.mode!==Cesium.SceneMode.MORPHING){var i=t.pick(e.position);if(t.pickPositionSupported&&Cesium.defined(i)&&i.node){var a=viewer.scene.pickPosition(e.position);if(Cesium.defined(a)){var o=Cesium.Cartographic.fromCartesian(a),r=Cesium.Math.toDegrees(o.longitude),s=Cesium.Math.toDegrees(o.latitude),g=o.height;mapPosition={x:r,y:s,z:g}}}}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}onClickLeft(){let e=this.opts,t=this._viewer,i=this;this.handler.setInputAction((function(a){let o=t.scene,r=t.camera.getPickRay(a.position),s=t.scene.globe.pick(r,o);if(i._etsMap.defined(s))if("line"==e.shapeType||"polygon"==e.shapeType){if(0===e.activeShapePoints.length){e.floatingPoint=i.createLabel(s,"\u53f3\u51fb\u7ed3\u675f\u6d4b\u91cf"),e.activeShapePoints.push(s);let t=new i._etsMap.CallbackProperty((function(){return"polygon"==e.shapeType?new i._etsMap.PolygonHierarchy(e.activeShapePoints):e.activeShapePoints}),!1);e.activeShape=i.shape(t)}e.activeShapePoints.push(s);let t=i.createPoint(s),a=i._etsMap.Cartographic.fromCartesian(e.activeShapePoints[e.activeShapePoints.length-1]),o=i._etsMap.Math.toDegrees(a.longitude),r=i._etsMap.Math.toDegrees(a.latitude),g=a.height;e.tempPoints.push({lon:o,lat:r,hei:g}),e.shapes.push(t)}else{let o=t.scene.pickPosition(a.position);0==e.positions.length&&(e.positions.push(o.clone()),e.positions.push(o),i.createPoint(e.positions,"0\u7c73"),e.floatingPoint=i.createLabel(e.positions,"\u53cc\u51fb\u7ed3\u675f\u6d4b\u91cf"))}}),this._etsMap.ScreenSpaceEventType.LEFT_CLICK)}_PolyLinePrimitive=function(){function e(e,t){this.options={parent:t.measureEntities,name:"\u76f4\u7ebf",polyline:{show:!0,positions:[],material:t._etsMap.Color.AQUA,width:2},ellipse:{show:!0,material:t._etsMap.Color.GREEN.withAlpha(.5),outline:!0}},this.Parent=t,this.positions=e,this._init(t)}return e.prototype._init=function(e){let t=this,i=function(){let i=e._etsMap.Cartographic.fromCartesian(t.positions[0]),a=e._etsMap.Cartographic.fromCartesian(t.positions[1]),o=new e._etsMap.EllipsoidGeodesic;return o.setEndPoints(i,a),o.surfaceDistance};this.options.polyline.positions=new e._etsMap.CallbackProperty((function(){let i=[];i.push(t.positions[0]);let a=e._etsMap.Cartographic.fromCartesian(t.positions[0]),o=e._etsMap.Cartographic.fromCartesian(t.positions[1]),r=e._etsMap.Cartesian3.fromDegrees(e._etsMap.Math.toDegrees(a.longitude),e._etsMap.Math.toDegrees(a.latitude),o.height);return i.push(r),i}),!1),this.options.position=new e._etsMap.CallbackProperty((function(){return t.positions[0]}),!1),this.options.ellipse.semiMinorAxis=new e._etsMap.CallbackProperty(i,!1),this.options.ellipse.semiMajorAxis=new e._etsMap.CallbackProperty(i,!1),this.options.ellipse.height=new e._etsMap.CallbackProperty((function(){return t.Parent.getHeight(t.positions)}),!1),this.Parent._viewer.entities.add(this.options)},e}();onMouseMove(){let e=this.opts,t=this._viewer,i=this;this.handler.setInputAction((function(a){if("line"==e.shapeType||"polygon"==e.shapeType){if(i._etsMap.defined(e.floatingPoint)){let o=t.scene,r=t.camera.getPickRay(a.endPosition),s=t.scene.globe.pick(r,o);i._etsMap.defined(s)&&(e.floatingPoint.position.setValue(s),e.activeShapePoints.pop(),e.activeShapePoints.push(s),e.lineDistance=i.getSpaceDistance(e.activeShapePoints))}}else{let o=t.scene.pickPosition(a.endPosition);e.positions.length>=2&&(i._etsMap.defined(i.poly)?(e.positions.pop(),e.positions.push(o)):i.poly=new i._PolyLinePrimitive(e.positions,i),e.floatingPoint.position.setValue(o),e.verticalDistance=i.getHeight(e.positions))}}),this._etsMap.ScreenSpaceEventType.MOUSE_MOVE)}doubleClick(){let e=this,t=this.opts;this.handler.setInputAction((function(i){let a=e._etsMap.Cartographic.fromCartesian(t.positions[0]),o=e._etsMap.Cartographic.fromCartesian(t.positions[1]),r=e._etsMap.Cartesian3.fromDegrees(e._etsMap.Math.toDegrees(a.longitude),e._etsMap.Math.toDegrees(a.latitude),o.height);e.createPoint(r,t.verticalDistance+"\u7c73"),e.terminateShape()}),this._etsMap.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}onClickRight(){let e=this.opts,t=this._viewer,i=this;this.handler.setInputAction((function(a){if("polygon"==e.shapeType&&e.activeShapePoints.length>2){e.activeShapePoints.map((function(a,o){let r=Tools$1.cartesianToCartographic(i._etsMap,t,a.x,a.y,a.z);e.shapeData.polygon.push(r[0],r[1])}));let a=i.getArea(e.tempPoints,e.activeShapePoints)+"\u5e73\u65b9\u516c\u91cc",o=i.createPoint(e.activeShapePoints[e.activeShapePoints.length-1],a);e.shapes.push(o),e.isEndDraw=!0}else{if(!("line"==e.shapeType&&e.activeShapePoints.length>2))return;e.activeShapePoints=e.activeShapePoints.slice(0,-1),e.activeShapePoints.map((function(a,o){let r=Tools$1.cartesianToCartographic(i._etsMap,t,a.x,a.y,a.z);e.shapeData.line.push(r[0],r[1])})),e.isEndDraw=!0}i.shape(e.activeShapePoints),i.terminateShape()}),this._etsMap.ScreenSpaceEventType.RIGHT_CLICK)}area(){let e=this.opts;e.isEndDraw=!1,this.depthTestAgainstTerrain=this._viewer.scene.globe.depthTestAgainstTerrain,e.isEndDraw||(this._viewer.scene.globe.depthTestAgainstTerrain=!1,e.shapeType="polygon",this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas),this.BindEvent())}line(){let e=this.opts;e.isEndDraw=!1,e.isEndDraw||(this.depthTestAgainstTerrain=this._viewer.scene.globe.depthTestAgainstTerrain,this._viewer.scene.globe.depthTestAgainstTerrain=!1,e.shapeType="line",this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.canvas),this.BindEvent())}height(){let e=this.opts;e.isEndDraw=!1,e.isEndDraw||(this.depthTestAgainstTerrain=this._viewer.scene.globe.depthTestAgainstTerrain,this._viewer.scene.globe.depthTestAgainstTerrain=!0,e.shapeType="height",this.handler=new this._etsMap.ScreenSpaceEventHandler(this._viewer.scene._imageryLayerCollection),this.BindEvent())}BindEvent=function(){this.onClickLeft(),this.onMouseMove(),this.onClickRight(),this.doubleClick()};end=function(){this.opts.isEndDraw=!0,this.handler.destroy(),this.poly=null,this._viewer.scene.globe.depthTestAgainstTerrain=this.depthTestAgainstTerrain}}class EtsBase{constructor(){this._etsMap=EtsMapApi.getApi(),this._viewer=EtsMapApi.getViewer()}}class DynamicHalo extends EtsBase{constructor(e){super(),this.options=e||{},this.CimMap=this._etsMap,this.viewer=this._viewer,this.cimImageLayer=null,this.options.eventListenerHandlers=[],this.options.coneGlowBottomCircleHandlers=[],this.options.coneGlowBottomRotateCircleHandlers=[],this.options.coneHandlers=[],this.init()}init(){this.addConeGlowBottomCircle(),this.addConeGlowBottomRotateCircle()}transformCoordinates(e,t,i){var a=t.scene.globe.ellipsoid,o=t.camera.pickEllipsoid(i.position,a);if(o){var r=a.cartesianToCartographic(o);return[e.Math.toDegrees(r.longitude),e.Math.toDegrees(r.latitude)]}return[]}addConeGlowBottomCircle(){var e=this.CimMap;function t(t){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t}Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),t.prototype.getType=function(e){return"ConeGlowBottomCircle"},t.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.image=e.Material.ConeGlowBottomCircleImage,i},t.prototype.equals=function(i){return this===i||i instanceof t&&e.Property.equals(this._color,i._color)},this.ConeGlowBottomCircleMaterialProperty=t,e.Material.ConeGlowBottomCircleType="ConeGlowBottomCircle",e.Material.ConeGlowBottomCircleImage=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d"),i=t.createRadialGradient(256,256,0,256,256,256);return i.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),i.addColorStop(.2,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.3,"rgba(255, 255, 255, 0.9)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),i.addColorStop(1,"rgba(255, 255, 255, 1.0)"),t.clearRect(0,0,512,512),t.beginPath(),t.arc(256,256,256,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.restore(),e.toDataURL("image/png").replace("image/png","image/octet-stream")}(),e.Material.ConeGlowBottomCircleSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tvec4 colorImage = texture2D(image,  vec2(st ));\n\tmaterial.alpha = colorImage.a * color.a;\n\tmaterial.diffuse =  1.5* color.rgb  ;\n\treturn material;\n}",e.Material._materialCache.addMaterial(e.Material.ConeGlowBottomCircleType,{fabric:{type:e.Material.ConeGlowBottomCircleType,uniforms:{color:new e.Color(1,0,0,.5),image:e.Material.ConeGlowBottomCircleImage,time:0},source:e.Material.ConeGlowBottomCircleSource},translucent:function(e){return!0}})}addConeGlowBottomRotateCircle(){var e=this.CimMap;function t(t){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t}Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),t.prototype.getType=function(e){return"ConeGlowBottomRotateCircle"},t.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.image=e.Material.ConeGlowBottomRotateCircleImage,i},t.prototype.equals=function(i){return this===i||i instanceof t&&e.Property.equals(this._color,i._color)},this.ConeGlowBottomRotateCircleMaterialProperty=t,e.Material.ConeGlowBottomRotateCircleType="ConeGlowBottomRotateCircle",e.Material.ConeGlowBottomRotateCircleImage=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d");return t.clearRect(0,0,512,512),t.strokeStyle="rgb(255, 255, 0)",t.setLineDash([60,80]),t.lineWidth=10,t.arc(256,256,241,0,2*Math.PI,!0),t.stroke(),e.toDataURL("image/png").replace("image/png","image/octet-stream")}(),e.Material.ConeGlowBottomRotateCircleSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tvec4 colorImage = texture2D(image, vec2(st ));\n\tmaterial.diffuse = 2.5 * color.rgb  ;\n\tmaterial.alpha = colorImage.a ;\n\treturn material;\n}",e.Material._materialCache.addMaterial(e.Material.ConeGlowBottomRotateCircleType,{fabric:{type:e.Material.ConeGlowBottomRotateCircleType,uniforms:{color:new e.Color(1,0,0,.5),image:e.Material.ConeGlowBottomRotateCircleImage,time:0},source:e.Material.ConeGlowBottomRotateCircleSource},translucent:function(e){return!0}})}addDynamicHalo(e){var t=e.center,i=e.radius,a=e.coneLength,o=e.coneColor,r=e.autoCircleColor,s=e.staticCircleColor,g=e.height;if(this.addBottomCircle(t,i,s,g),this.addBottomRotateCircle(t,i,r,g),e.isShowCylinder){var n=this.addCone(t,i,a,o,g);this.preUpdateHandle(n)}}addCone(e,t,i,a,o){var r=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],o),s=this.CimMap.Matrix4.multiplyByTranslation(this.CimMap.Transforms.eastNorthUpToFixedFrame(r),new this.CimMap.Cartesian3(0,0,.5*i),new this.CimMap.Matrix4),g=new this.CimMap.CylinderGeometry({length:i,topRadius:0,bottomRadius:.7*t,vertexFormat:this.CimMap.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat}),n=new this.CimMap.GeometryInstance({geometry:g,modelMatrix:s}),C=this.viewer.scene.primitives.add(new this.CimMap.Primitive({geometryInstances:[n],appearance:new this.CimMap.MaterialAppearance({material:new this.CimMap.Material({fabric:{type:"VtxfShader1",uniforms:{color:a,alpha:2},source:"uniform vec4 color;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tfloat dis = distance(st, vec2(0.5));\n\tmaterial.diffuse =2.9 * color.rgb;\n\tmaterial.alpha = color.a * dis * alpha ;\n\treturn material;\n}"},translucent:!1}),faceForward:!1,closed:!0})}));return this.options.coneHandlers.push(C),C}addBottomCircle(e,t,i,a){var o=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],a),r=this.viewer.entities.add({position:o,ellipse:{semiMinorAxis:2*t,semiMajorAxis:2*t,height:a,material:new this.ConeGlowBottomCircleMaterialProperty(i)}});return this.options.coneGlowBottomCircleHandlers.push(r),r}addBottomRotateCircle(e,t,i,a){var o=360,r=this,s=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],a),g=this.viewer.entities.add({position:s,ellipse:{semiMinorAxis:1.45*t,semiMajorAxis:1.45*t,height:a,material:new this.ConeGlowBottomRotateCircleMaterialProperty(i),stRotation:new this.CimMap.CallbackProperty((function(e){return--o<0&&(o=360),r.CimMap.Math.toRadians(o)}),!1)}});return this.options.coneGlowBottomRotateCircleHandlers.push(g),g}preUpdateHandle(e){var t=this.viewer.scene.preUpdate.addEventListener((function(){e.appearance.material.uniforms.alpha+=.05,e.appearance.material.uniforms.alpha>2.5&&(e.appearance.material.uniforms.alpha=2)}));return this.options.eventListenerHandlers.push(t),t}removeCone(){for(var e=0;e<this.options.eventListenerHandlers.length;e++)this.viewer.scene.preUpdate.removeEventListener(this.options.eventListenerHandlers[e]);for(e=0;e<this.options.coneHandlers.length;e++)this.viewer.scene.primitives.remove(this.options.coneHandlers[e]);for(e=0;e<this.options.coneGlowBottomCircleHandlers.length;e++)this.viewer.entities.remove(this.options.coneGlowBottomCircleHandlers[e]);for(e=0;e<this.options.coneGlowBottomRotateCircleHandlers.length;e++)this.viewer.entities.remove(this.options.coneGlowBottomRotateCircleHandlers[e]);this.options.eventListenerHandlers=[],this.options.coneGlowBottomCircleHandlers=[],this.options.coneGlowBottomRotateCircleHandlers=[],this.options.coneHandlers=[]}}class DynamicHaloBottom extends EtsBase{constructor(e){super(),this.options=e||{},this.CimMap=this._etsMap,this.viewer=this._viewer,this.cimImageLayer=null,this.options.eventListenerHandlers=[],this.options.BottomConeGlowBottomCircleHandlers=[],this.options.BottomConeGlowBottomRotateCircleHandlers=[],this.options.coneHandlers=[],this.init()}init(){this.addBottomConeGlowBottomCircle(),this.addBottomConeGlowBottomRotateCircle()}transformCoordinates(e,t,i){var a=t.scene.globe.ellipsoid,o=t.camera.pickEllipsoid(i.position,a);if(o){var r=a.cartesianToCartographic(o);return[e.Math.toDegrees(r.longitude),e.Math.toDegrees(r.latitude)]}return[]}addBottomConeGlowBottomCircle(){var e=this.CimMap;function t(t){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t}Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),t.prototype.getType=function(e){return"BottomConeGlowBottomCircle"},t.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.image=e.Material.BottomConeGlowBottomCircleImage,i},t.prototype.equals=function(i){return this===i||i instanceof t&&e.Property.equals(this._color,i._color)},this.BottomConeGlowBottomCircleMaterialProperty=t,e.Material.BottomConeGlowBottomCircleType="BottomConeGlowBottomCircle",e.Material.BottomConeGlowBottomCircleImage=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d"),i=t.createRadialGradient(256,256,0,256,256,256);return i.addColorStop(.1,"rgba(255, 255, 255, 6.0)"),i.addColorStop(.2,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),i.addColorStop(1,"rgba(255, 255, 255, 0.2)"),t.clearRect(0,0,512,512),t.beginPath(),t.arc(256,256,230,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.restore(),e.toDataURL("image/png").replace("image/png","image/octet-stream")}(),e.Material.BottomConeGlowBottomCircleSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tvec4 colorImage = texture2D(image,  vec2(st ));\n\tmaterial.alpha = colorImage.a * color.a;\n\tmaterial.diffuse =  1.5* color.rgb  ;\n\treturn material;\n}",e.Material._materialCache.addMaterial(e.Material.BottomConeGlowBottomCircleType,{fabric:{type:e.Material.BottomConeGlowBottomCircleType,uniforms:{color:new e.Color(1,0,0,.5),image:e.Material.BottomConeGlowBottomCircleImage,time:0},source:e.Material.BottomConeGlowBottomCircleSource},translucent:function(e){return!0}})}addBottomConeGlowBottomRotateCircle(){var e=this.CimMap;function t(t){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t}Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),t.prototype.getType=function(e){return"BottomConeGlowBottomRotateCircle"},t.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.image=e.Material.BottomConeGlowBottomRotateCircleImage,i},t.prototype.equals=function(i){return this===i||i instanceof t&&e.Property.equals(this._color,i._color)},this.BottomConeGlowBottomRotateCircleMaterialProperty=t,e.Material.BottomConeGlowBottomRotateCircleType="BottomConeGlowBottomRotateCircle",e.Material.BottomConeGlowBottomRotateCircleImage=function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d");return t.clearRect(0,0,512,512),t.strokeStyle="rgb(255, 255, 0)",t.setLineDash([5,5]),t.lineWidth=.2,t.arc(256,256,210,0,2*Math.PI,!0),t.stroke(),e.toDataURL("image/png").replace("image/png","image/octet-stream")}(),e.Material.BottomConeGlowBottomRotateCircleSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tvec4 colorImage = texture2D(image, vec2(st ));\n\tmaterial.diffuse = 2.5 * color.rgb  ;\n\tmaterial.alpha = colorImage.a ;\n\treturn material;\n}",e.Material._materialCache.addMaterial(e.Material.BottomConeGlowBottomRotateCircleType,{fabric:{type:e.Material.BottomConeGlowBottomRotateCircleType,uniforms:{color:new e.Color(1,0,0,.5),image:e.Material.BottomConeGlowBottomRotateCircleImage,time:0},source:e.Material.BottomConeGlowBottomRotateCircleSource},translucent:function(e){return!0}})}addDynamicHalo(e){var t=e.center,i=e.radius,a=e.coneLength,o=e.coneColor,r=e.autoCircleColor,s=e.staticCircleColor,g=e.height;if(this.addBottomCircle(t,i,s,g),this.addBottomRotateCircle(t,i,r,g),e.isShowCylinder){var n=this.addCone(t,i,a,o,g);this.preUpdateHandle(n)}}addCone(e,t,i,a,o){var r=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],o),s=this.CimMap.Matrix4.multiplyByTranslation(this.CimMap.Transforms.eastNorthUpToFixedFrame(r),new this.CimMap.Cartesian3(0,0,.5*i),new this.CimMap.Matrix4),g=new this.CimMap.CylinderGeometry({length:i,topRadius:0,bottomRadius:.7*t,vertexFormat:this.CimMap.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat}),n=new this.CimMap.GeometryInstance({geometry:g,modelMatrix:s}),C=this.viewer.scene.primitives.add(new this.CimMap.Primitive({geometryInstances:[n],appearance:new this.CimMap.MaterialAppearance({material:new this.CimMap.Material({fabric:{type:"VtxfShader1",uniforms:{color:a,alpha:2},source:"uniform vec4 color;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tfloat dis = distance(st, vec2(0.5));\n\tmaterial.diffuse =2.9 * color.rgb;\n\tmaterial.alpha = color.a * dis * alpha ;\n\treturn material;\n}"},translucent:!1}),faceForward:!1,closed:!0})}));return this.options.coneHandlers.push(C),C}addBottomCircle(e,t,i,a){var o=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],a),r=this.viewer.entities.add({position:o,ellipse:{semiMinorAxis:1.7*t,semiMajorAxis:1.7*t,height:a,material:new this.BottomConeGlowBottomCircleMaterialProperty(i)}});return this.options.BottomConeGlowBottomCircleHandlers.push(r),r}addBottomRotateCircleBg(e,t,i,a){var o=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],a),r=this.viewer.entities.add({position:o,ellipse:{semiMinorAxis:1.85*t,semiMajorAxis:1.85*t,height:a,material:this.CimMap.Color.RED.withAlpha(.2),outline:!1,outlineColor:this.CimMap.Color.BLUR}});return this.options.BottomConeGlowBottomRotateCircleHandlers.push(r),r}addBottomRotateCircle(e,t,i,a){let o=360;var r=this,s=this.CimMap.Cartesian3.fromDegrees(e[0],e[1],a),g=this.viewer.entities.add({position:s,ellipse:{semiMinorAxis:1.65*t,semiMajorAxis:1.65*t,height:a,material:new this.BottomConeGlowBottomRotateCircleMaterialProperty(i),stRotation:new this.CimMap.CallbackProperty((function(){return o-=.05,(o>=360||o<=-360)&&(o=0),r.CimMap.Math.toRadians(o)}),!1)}});return this.options.BottomConeGlowBottomRotateCircleHandlers.push(g),g}preUpdateHandle(e){var t=this.viewer.scene.preUpdate.addEventListener((function(){e.appearance.material.uniforms.alpha+=.05,e.appearance.material.uniforms.alpha>2.5&&(e.appearance.material.uniforms.alpha=2)}));return this.options.eventListenerHandlers.push(t),t}removeCone(){for(var e=0;e<this.options.eventListenerHandlers.length;e++)this.viewer.scene.preUpdate.removeEventListener(this.options.eventListenerHandlers[e]);for(e=0;e<this.options.coneHandlers.length;e++)this.viewer.scene.primitives.remove(this.options.coneHandlers[e]);for(e=0;e<this.options.BottomConeGlowBottomCircleHandlers.length;e++)this.viewer.entities.remove(this.options.BottomConeGlowBottomCircleHandlers[e]);for(e=0;e<this.options.BottomConeGlowBottomRotateCircleHandlers.length;e++)this.viewer.entities.remove(this.options.BottomConeGlowBottomRotateCircleHandlers[e]);this.options.eventListenerHandlers=[],this.options.BottomConeGlowBottomCircleHandlers=[],this.options.BottomConeGlowBottomRotateCircleHandlers=[],this.options.coneHandlers=[]}}class DynamicScanWall extends EtsBase{constructor(e){super(),this.options=e||{},this.Cesium=this._etsMap,this.viewer=this._viewer,this.options.radius=this.options.radius||500,this.options.currentRadius=0,this.options.rPositions=[],this.options.speed=1,this.options.heightOffset=100,this.options.minHeight=0,this.options.edgeNumber=this.options.edgeNumber||180,this.options.centerDegrees=[this.options.lon,this.options.lat,this.options.height],this.options.color=this.options.color||this._etsMap.Color.RED}addWall(e){this.options=Object.assign({},this.options,e),this.options.radius=this.options.radius||500,this.options.currentRadius=0,this.options.rPositions=[],this.options.edgeNumber=this.options.edgeNumber||180,this.options.centerDegrees=[this.options.lon,this.options.lat,this.options.height],this.options.color=this.options.color||this._etsMap.Color.RED,this.customMater();let t=this;return this._viewer.entities.add({wall:{positions:new t._etsMap.CallbackProperty((function(e){return t.getPositions(t._etsMap)}),!1),minimumHeights:this.minimumHeights,maximumHeights:this.maximumHeights,minimumHeights:new t._etsMap.CallbackProperty((function(e){return t.minimumHeights}),!1),maximumHeights:new t._etsMap.CallbackProperty((function(e){return t.maximumHeights}),!1),material:new this.WallGradientsMaterialProperty(t._etsMap.Color.GRAY)}})}getCirclePoint(e,t,i,a){var o=a*Math.sin(i*Math.PI/180),r=a*Math.cos(i*Math.PI/180),s=6356725+21412*(90-t)/90;return[180*(o/(s*Math.cos(t*Math.PI/180))+e*Math.PI/180)/Math.PI,180*(r/s+t*Math.PI/180)/Math.PI]}generateCirclePoints(e,t){for(var i=360/this.options.edgeNumber,a=[],o=0;o<=360;o+=i)a.push(this.getCirclePoint(e[0],e[1],o,t));return a}getPositions(e){if(this.options.currentRadius+=50*this.options.speed,this.options.currentRadius>this.options.radius&&(this.options.currentRadius=1),this.options.rPositions[this.options.currentRadius])return this.options.rPositions[this.options.currentRadius];var t=this.generateCirclePoints([this.options.centerDegrees[0],this.options.centerDegrees[1]],this.options.currentRadius),i=this.pointsToPositions(e,t,this.options.centerDegrees[2]);return this.options.rPositions[this.options.currentRadius]=i,this.options.rPositions[this.options.currentRadius]}pointsToPositions(e,t,i){var a=[];this.maximumHeights=[],this.minimumHeights=[];let o=this;return t.map((function(t){a.push(e.Cartesian3.fromDegrees(t[0],t[1],i)),o.maximumHeights.push(i+o.options.heightOffset),o.minimumHeights.push(o.options.minHeight)})),a}customMater(){let e=this._etsMap,t=this;var i=function(){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t.options.color};Object.defineProperties(i.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),i.prototype.getType=function(e){return"WallGradients"},i.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.image=e.Material.WallGradientsImage,i},i.prototype.equals=function(t){return this===t||t instanceof i&&e.Property.equals(this._color,t._color)},this.WallGradientsMaterialProperty=i,e.Material.WallGradientsType="WallGradients",e.Material.WallGradientsImage=this.options.wallImage,e.Material.WallGradientsSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n\tczm_material material = czm_getDefaultMaterial(materialInput);\n\tvec2 st = materialInput.st;\n\tvec4 colorImage = texture2D(image, vec2(fract(st.t - time), st.t));\n\tmaterial.alpha = colorImage.a * color.a;\n\tmaterial.diffuse =  2.5 * color.rgb  ;\n\treturn material;\n}",e.Material._materialCache.addMaterial(e.Material.WallGradientsType,{fabric:{type:e.Material.WallGradientsType,uniforms:{color:new e.Color(1,0,0,.5),image:e.Material.WallGradientsImage,time:0},source:e.Material.WallGradientsSource},translucent:function(e){return!0}})}}class CircleScan extends EtsBase{constructor(){super()}addScan(e,t,i,a,o,r){let s=this._etsMap,g=this._viewer,n=new s.Cartographic(s.Math.toRadians(e),s.Math.toRadians(t),i);var C=s.Cartographic.toCartesian(n),l=new s.Cartesian4(C.x,C.y,C.z,1),A=new s.Cartographic(n.longitude,n.latitude,n.height+500),I=s.Cartographic.toCartesian(A),h=new s.Cartesian4(I.x,I.y,I.z,1),c=(new Date).getTime(),p=new s.Cartesian4,d=new s.Cartesian4,u=new s.Cartesian3,m=new s.PostProcessStage({fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nuniform vec4 u_scanCenterEC;\nuniform vec3 u_scanPlaneNormalEC;\nuniform float u_radius;\nuniform vec4 u_scanColor;\nvec4 toEye(in vec2 uv, in float depth)\n {\n vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n posInCamera =posInCamera / posInCamera.w;\n return posInCamera;\n }\nvec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point)\n{\nvec3 v01 = point -planeOrigin;\nfloat d = dot(planeNormal, v01) ;\nreturn (point - planeNormal * d);\n}\nfloat getDepth(in vec4 depth)\n{\nfloat z_window = czm_unpackDepth(depth);\nz_window = czm_reverseLogDepth(z_window);\nfloat n_range = czm_depthRange.near;\nfloat f_range = czm_depthRange.far;\nreturn (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nvoid main()\n{\ngl_FragColor = texture2D(colorTexture, v_textureCoordinates);\nfloat depth = getDepth( texture2D(depthTexture, v_textureCoordinates));\nvec4 viewPos = toEye(v_textureCoordinates, depth);\nvec3 prjOnPlane = pointProjectOnPlane(u_scanPlaneNormalEC.xyz, u_scanCenterEC.xyz, viewPos.xyz);\nfloat dis = length(prjOnPlane.xyz - u_scanCenterEC.xyz);\nif(dis < u_radius)\n{\nfloat f = 1.0 -abs(u_radius - dis) / u_radius;\nf = pow(f, 4.0);\ngl_FragColor = mix(gl_FragColor, u_scanColor, f);\n}\n}\n",uniforms:{u_scanCenterEC:function(){return s.Matrix4.multiplyByVector(g.camera._viewMatrix,l,p)},u_scanPlaneNormalEC:function(){var e=s.Matrix4.multiplyByVector(g.camera._viewMatrix,l,p),t=s.Matrix4.multiplyByVector(g.camera._viewMatrix,h,d);return u.x=t.x-e.x,u.y=t.y-e.y,u.z=t.z-e.z,s.Cartesian3.normalize(u,u),u},u_radius:function(){return a*(((new Date).getTime()-c)%r)/r},u_scanColor:o}});g.scene.postProcessStages.add(m)}}class ODAnalysis extends EtsBase{constructor(){super(),this.opts={id:"odLine",CIMMAP_STEP:1,coordinatesData:{},nameData:[],entity:[],width:2,repeat:2,lineColor:"rgba(76,81,57,0.8)",lightColor:"rgb(255,2,8,1)",images:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5IAAAAeCAYAAABe6yEsAAAACXBIWXMAAAsTAAALEwEAmpwYAAA7r2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxOS0wNC0xMlQyMDoxMzoxNiswODowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDIwLTA0LTIzVDE3OjA2OjEyKzA4OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAyMC0wNC0yM1QxNzowNjoxMiswODowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDozNzYwOGY1My00YTJiLTRlMjctOTY0OS0wYWY2MzY1YzE2MDQ8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDoyNTg2YmI2OC1lY2UzLTExN2MtOTQxMi1kZDc0OWIzNGEyOWE8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDpmNDYwNjA3Ny0zM2E2LTRlZGQtOGU5ZS05N2ExYmI0NDNhZmI8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZjQ2MDYwNzctMzNhNi00ZWRkLThlOWUtOTdhMWJiNDQzYWZiPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA0LTEyVDIwOjEzOjE2KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZDllNWI3ZTMtYmE3YS00YjRkLTg3OTUtM2E5MmJlZGI1ZjE2PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA3LTE1VDE3OjA0OjU4KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6Mzc2MDhmNTMtNGEyYi00ZTI3LTk2NDktMGFmNjM2NWMxNjA0PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDIwLTA0LTIzVDE3OjA2OjEyKzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+OTE0PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjMwPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAg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",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAwCAYAAACfbhNRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkE1RTRCMTc5RDQyQjExRTc4MkRFQ0ExODQ2Q0JCMkEzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkE1RTRCMTdBRDQyQjExRTc4MkRFQ0ExODQ2Q0JCMkEzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QTVFNEIxNzdENDJCMTFFNzgyREVDQTE4NDZDQkIyQTMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QTVFNEIxNzhENDJCMTFFNzgyREVDQTE4NDZDQkIyQTMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6AXAWMAAAKVUlEQVR42rxYC3RU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"}}create(e){let t=this;this.CimMap=this._etsMap;let i=Object.assign({scale:1,height:0,url:"",pointIds:[],lineIds:[],speed:2e3,id:""},this.opts,e);if(this.viewer,!i.nameData)return;i.id||(i.id="PolylineTrail");let a=this,o=!0;return i.nameData.map((function(e){let r=null,s=null,g=null,n=null,C=e.from,l=e.to,A=a.CimMap.Cartesian3.fromDegrees(Number(i.coordinatesData[C][0]),Number(i.coordinatesData[C][1]),0),I=a.CimMap.Cartesian3.fromDegrees(Number(i.coordinatesData[l][0]),Number(i.coordinatesData[l][1]),0),h=t.generateCurve(A,I),c=i.lineColor;i.lightColor,a.customMaterial(i);let p={name:"PolylineTrail",polyline:{positions:h,width:i.width*i.CIMMAP_STEP+2,material:new a.CustomOdLineMaterialProperty(a.CimMap.Color.fromAlpha(a.CimMap.Color.fromCssColorString(i.lightColor),parseFloat(1)),i.speed)}};s=a._viewer.entities.add(p),i.entity.push(s);let d={id:C+"_"+l,attributes:{type:"od-line",startName:C,endName:l},key:"od",type:"line",description:"od-line",name:"od-line",polyline:{width:i.width*i.CIMMAP_STEP,positions:h,material:a.CimMap.Color.fromCssColorString(c)}};if(r=a._viewer.entities.add(d),i.entity.push(r),i.lineIds.push(r.id),o){let e="";e=i.coordinatesData[C][2]?i.coordinatesData[C][2]:i.icon;let t={attributes:{type:"od-point",startName:C,longitude:Number(i.coordinatesData[C][0]),latitude:Number(i.coordinatesData[C][1]),scale:i.scale},key:"od",type:"point",name:C,position:a.CimMap.Cartesian3.fromDegrees(Number(i.coordinatesData[C][0]),Number(i.coordinatesData[C][1]),Number(i.height)),billboard:{scale:i.scale*i.CIMMAP_STEP,image:e,verticalOrigin:a.CimMap.VerticalOrigin.BOTTOM}};g=a._viewer.entities.add(t),i.entity.push(g),i.pointIds.push(g.id),o=!1}let u="";u=i.coordinatesData[l][2]?i.coordinatesData[l][2]:i.icon;let m={attributes:{type:"od-point",startName:l,longitude:Number(i.coordinatesData[l][0]),latitude:Number(i.coordinatesData[l][1]),scale:i.scale},key:"od",type:"point",name:l,position:a.CimMap.Cartesian3.fromDegrees(Number(i.coordinatesData[l][0]),Number(i.coordinatesData[l][1]),Number(i.height)),billboard:{scale:i.scale*i.CIMMAP_STEP,image:u,verticalOrigin:a.CimMap.VerticalOrigin.BOTTOM}};n=a._viewer.entities.add(m),i.entity.push(n),i.pointIds.push(n.id)})),{pointIds:i.pointIds,lineIds:i.lineIds}}generateCurve(e,t){let i=new this.CimMap.Cartesian3;this.CimMap.Cartesian3.add(e,t,i);let a=new this.CimMap.Cartesian3;this.CimMap.Cartesian3.divideByScalar(i,2,a);let o=this.CimMap.Cartographic.fromCartesian(a);o.height=this.CimMap.Cartesian3.distance(e,t)/10;let r=new this.CimMap.Cartesian3;this.CimMap.Ellipsoid.WGS84.cartographicToCartesian(o,r);let s=new this.CimMap.CatmullRomSpline({times:[0,.5,1],points:[e,r,t]}),g=[];for(let e=0,t=300;e<t;e++)g.push(s.evaluate(e/t));return g.push(t),g}remove(){let e=this;this.opts.entity.map((function(t){e.viewer.entities.removeById(t.id)}))}customMaterial(e){let t=this._etsMap,i=new Number(this.opts.repeat).toFixed(1);function a(e,i){this._definitionChanged=new t.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e,this.duration=i,this._time=(new Date).getTime()}Object.defineProperties(a.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:t.createPropertyDescriptor("color")}),a.prototype.getType=function(t){return"odLine_"+e.id},a.prototype.getValue=function(e,i){return t.defined(i)||(i={}),i.color=t.Property.getValueOrClonedDefault(this._color,e,t.Color.BLUE,i.color),i.image=t.Material.odLineImage,i.time=((new Date).getTime()-this._time)%this.duration/this.duration,i},a.prototype.equals=function(e){return this===e||e instanceof a&&t.Property.equals(this._color,e._color)},console.log(this.opts),console.log(i),this.CustomOdLineMaterialProperty=a,t.Material.odLineType="odLine_"+e.id,t.Material.odLineImage=e.images,t.Material.odLineSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec4 colorImage = texture2D(image, vec2(fract("+i+"*st.s - time), st.t));\nmaterial.alpha = colorImage.a * color.a;\nmaterial.diffuse = (colorImage.rgb+color.rgb) / 2.0;\nreturn material;}\n",t.Material._materialCache.addMaterial(t.Material.odLineType,{fabric:{type:t.Material.odLineType,uniforms:{color:new t.Color(1,0,0,.5),image:t.Material.odLineImage,time:0},source:t.Material.odLineSource},translucent:function(e){return!0}})}}class FlyLine extends EtsBase{constructor(){super()}generateRandomLines(e,t){let i=[];for(let a=0;a<t;a++){let t=e[0]+.1*(Math.random()-.5),a=e[1]+.1*(Math.random()-.5);const o=new Cesium.PolylineGeometry({positions:Cesium.Cartesian3.fromDegreesArrayHeights([t,a,0,t,a,5e3*Math.random()]),width:1}),r=new Cesium.GeometryInstance({geometry:o});i.push(r)}return i}generateLines(e,t,i){let a=[];const o=new this._etsMap.PolylineGeometry({positions:this._etsMap.Cartesian3.fromDegreesArrayHeights([e,t,0,e,t,i]),width:1}),r=new this._etsMap.GeometryInstance({geometry:o});return a.push(r),a}getSource(){return"\n            uniform vec4 color;\n            uniform float speed;\n            uniform float percent;\n            uniform float gradient;\n            \n            czm_material czm_getMaterial(czm_materialInput materialInput){\n              czm_material material = czm_getDefaultMaterial(materialInput);\n              vec2 st = materialInput.st;\n              float t = fract(czm_frameNumber * speed / 1000.0);\n              t *= (1.0 + percent);\n              float alpha = smoothstep(t- percent, t, st.s) * step(-t, -st.s);\n              alpha += gradient;\n              material.diffuse = color.rgb;\n              material.alpha = alpha;\n              material.emission = vec3(0.7);\n              return material;\n            }\n            "}addLine(e,t,i,a){const o=new Cesium.Primitive({geometryInstances:this.generateLines(e,t,i),appearance:new this._etsMap.PolylineMaterialAppearance({material:new this._etsMap.Material({fabric:{uniforms:{color:a||new this._etsMap.Color(1,.5,0,.5),speed:5,percent:.2,gradient:0},source:this.getSource()}})}),allowPicking:!1});this._viewer.scene.primitives.add(o)}}EtsMap.Camera=Camera,EtsMap.EtsEvent=EtsEvent,EtsMap.EtsTips=EtsTips,EtsMap.ShapeLayer=ShapeLayer,EtsMap.DynamicWall=DynamicWall,EtsMap.DynamicWallEntity=DynamicWallEntity,EtsMap.MarkerLayer=MarkerLayer,EtsMap.ImageryLayer=ImageryLayer,EtsMap.TilesLayer=TilesLayer,EtsMap.SingleModelLayer=SingleModelLayer,EtsMap.EtsHeatMap=EtsHeatMap,EtsMap.Coord=Coord,EtsMap.Measure=Measure,EtsMap.Tools=Tools$1,EtsMap.DynamicHalo=DynamicHalo,EtsMap.DynamicHaloBottom=DynamicHaloBottom,EtsMap.DynamiScan=DynamicHaloBottom,EtsMap.DynamicScanWall=DynamicScanWall,EtsMap.CircleScan=CircleScan,EtsMap.ODAnalysis=ODAnalysis,EtsMap.FlyLine=FlyLine})();
